!function(t,n){"use strict";"function"==typeof define&&define.amd?define(["moment"],n):"object"==typeof module&&module.exports?module.exports=n(require("./moment")):t.butil=n(t.moment)}(this,function(t){"use strict";const n=Math.min,e=Math.max,r=Math.abs,u=Math.pow,o=Math.log10,i=Math.floor,l=Math.round,f=Math.sign,c=86400,s=7*c,a={y:365.25*c,m:365.25*c/12,w:7*c,d:c,h:3600};function d(t){return Array.isArray(t)}function h(t,n=1e-7){return r(t)<n?0:t}function m(t,n,e){return n>e&&([n,e]=[e,n]),t<n?n:t>e?e:t}function p(t,n=10,e=5,f=0){if(isNaN(t))return t.toString();t=h(t);let c,s,a=i(r(t));a=0===a?0:a.toString().length,r(t)>u(10,a)-.5&&(a+=1),c=0===a&&0!==t?i(e-o(r(t))):e;let d=t*u(10,c),g=d%10;g<0&&(g+=10),g>=4.5&&g<4.9999999&&(d=i(d));let y=l(d)/u(10,c)+1e-10;if(f<0&&y>t||f>0&&y<t){if(!(e>=10))return p(t,n,e+1,f);y=t}return n<a&&r(u(10,a-1)-y)<.5&&(y=u(10,a-1)),n=m(n,a,a+e),r(y)<1e-4||9===i(y)||99===i(y)||999===i(y)?s=parseFloat(t.toPrecision(c)).toString():(s=y.toPrecision(n)).includes("e")||(s=parseFloat(s)),s}function g(t){const n=(t="string"==typeof t?t.trim():t.toString()).charAt(0),e=t.substr(1);if("+"===n&&(t=e),"-"===n)return"-"+g(e);t=t.replace(/^0+([^eE])/,"$1");if(/^(?:\d+\.?\d*|\.\d+)$/.test(t))return t;const r=t.match(/^(\d+\.?\d*|\.\d+)e([+-]?\d+)$/i);if(!r||3!==r.length)return"NaN";let[,u,o]=r,i=u.indexOf(".");return-1===i&&(i=u.length),i+=+o,u=u.replace(/\./,""),i<0?"."+"0".repeat(-i)+u:(i>u.length?u+="0".repeat(i-u.length):u=u.substring(0,i)+"."+u.substring(i),u.replace(/\.$/,"").replace(/^0+(.)/,"$1"))}function y(t,n=1){if(n<0)return NaN;if(0===n)return+t;const e=l(t/n),r=g(n).match(/^0?\.(0*)10*$/);return r?+g(`${e}e${-r[1].length-1}`):e*n}function N(n){let e=t.unix(n).utc(),r=e.year(),u=e.month()+1;u=u<10?"0"+u.toString():u.toString();let o=e.date();return r+"."+u+"."+(o=o<10?"0"+o.toString():o.toString())}let R=RegExp("^(\\d{4})(\\d{2})(\\d{2})$"),E="YYYYMMDD";return{MAXTIME:6e4,BBURL:"http://brain.beeminder.com/",BHUE:{DYEL:"#ffff44",LYEL:"#ffff88",ROSE:"#ff8080",AKRA:"#4C4Cff",PURP:"#B56bb5",LPURP:"#E5BbE5",BLUE:"#EAEAFF",GRUE:"#b5ffDE",ORNG:"#ff8000",WITE:"#ffffff",BIGG:"#ffe54c",PINK:"#ffe5e5",PNKE:"#ffcccc",GRAY:"#f0f0f0",BLCK:"#000000",REDDOT:"#ff0000",ORNDOT:"#ffa500",BLUDOT:"#3f3fff",GRNDOT:"#00aa00",GRADOT:"#228B22",ERRDOT:"#00FFFF",RAZR0:"#ff0000",RAZR1:"#ffa500",RAZR2:"#3f3fff",RAZR3:"#6BC461"},AKH:s,BDUSK:4102444799,SECS:a,UNAM:{y:"year",m:"month",w:"week",d:"day",h:"hour"},nummy:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},stringy:function(t){return"string"==typeof t},listy:d,arrMin:function(t){return n.apply(null,t)},arrMax:function(t){return e.apply(null,t)},extendo:function t(n,e,r){let u,o;for(u in e)(o=void 0!==n[u])&&"object"==typeof e[u]&&null!==e[u]&&void 0===e[u].nodeName?d(e[u])?r&&(n[u]=e[u].slice(0)):n[u]=t({},e[u],r):!r&&o||(d(e[u])?n[u]=e[u].slice(0):n[u]=e[u]);return n},deepcopy:function t(n){let e,r,u;if("object"!=typeof n||null===n)return n;for(u in e=d(n)?[]:{},n)r=n[u],e[u]=t(r);return e},partition:function(t,n,e){let r=t.length,u=[];for(let o=0;o<r;o+=e)o+n<=r&&u.push(t.slice(o,o+n));return u},quantile:function(t,n,e=1,r=!1){let u;if(u=r?t:t.slice().sort((t,n)=>t-n),e<1||e>9)return null;let o=[[0,0,1,0],[.5,0,1,0],[.5,0,0,0],[0,0,0,1],[.5,0,0,1],[0,1,0,1],[1,-1,0,1],[1/3,1/3,0,1],[3/8,.25,0,1]],l=o[e-1][0],c=o[e-1][1],s=o[e-1][2],a=o[e-1][3],d=t.length,h=function(t){const n=f(t),e=i(n*t);return[n*(n*t-e),n*e]}(l+(d+c)*n-1),m=h[0],p=h[1];return p<0?u[0]:p>=d?u[d-1]:(p=i(p),0==m?u[p]:u[p]+(u[p+1]-u[p])*(s+a*m))},sum:function(t){return t.reduce((t,n)=>t+n,0)},accumulate:function(t){let n=t.length;if(0===n)return t;let e=[t[0]];for(let r=1;r<n;r++)e.push(e[e.length-1]+t[r]);return e},monotonize:function(t,r=1){let u,o=t.slice();if(1===r)for(u=1;u<o.length;u++)o[u]=e(o[u-1],o[u]);else for(u=1;u<o.length;u++)o[u]=n(o[u-1],o[u]);return o},zip:function(t){return t[0].map((n,e)=>t.map(t=>t[e]))},chop:h,clip:m,searchLow:function(t,n){if(!t||!t.length)return-1;let e,r=-1,u=t.length;for(;u-r>1;)n(t[e=i((r+u)/2)])<0?r=e:u=e;return u===t.length||0!==n(t[u])?r:u},searchHigh:function(t,n){if(!t||!t.length)return 0;let e,r=-1,u=t.length;for(;u-r>1;)n(t[e=i((r+u)/2)])<=0?r=e:u=e;return-1===r||0!==n(t[r])?u:r},shn:p,shd:function(t){return null===t?"null":N(t)},splur:function(t,n,e=""){return""===e&&(e=n+"s"),p(t,10,5)+" "+(1===t?n:e)},conservaround:function(t,n=1,e=0){let r=y(t,n);return 0===e?r:(e<0&&r>t&&(r-=n),e>0&&r<t&&(r+=n),y(r,n))},linspace:function(t,n,r){if(void 0===r&&(r=e(l(n-t)+1,1)),r<2)return 1===r?[t]:[];let u,o=Array(r);for(u=--r;u>=0;u--)o[u]=(u*n+(r-u)*t)/r;return o},rescale:function(t,n,e,u,o){return r(n-e)<1e-7?t<=(n+e)/2?u:o:u+(t-n)/(e-n)*(o-u)},deldups:function(t,n=(t=>t)){let e={};return t.filter(t=>{const r=JSON.stringify(n(t));return!(r in e)&&(e[r]=!0)})},orderedq:function(t){for(let n=0;n<t.length-1;n++)if(t[n]>t[n+1])return!1;return!0},nonzero:function(t){let n,e=t.length;for(n=0;n<e;n++)if(0!==t[n])return!0;return!1},clocky:function(t){let n=0;for(let e=1;e<t.length;e+=2)n+=t[e]-t[e-1];return n},mean:function(t){let n,e=0,r=t.length;if(0==r)return 0;for(n=0;n<r;n++)e+=t[n];return e/t.length},median:function(t){let n=0,e=t.length;return t.sort((t,n)=>t-n),n=e%2==0?(t[e/2-1]+t[e/2])/2:t[(e-1)/2]},mode:function(t){if(!t||!t.length)return NaN;let n={},e=1,r=t[0];for(const u in t)n[t[u]]=(n[t[u]]||0)+1,n[t[u]]>e&&(e=n[t[u]],r=t[u]);return r},trimmean:function(t,n){const e=i(t.length*n),r=t.sort((t,n)=>t-n).slice(e,t.length-e);return r.reduce((t,n)=>t+n)/r.length},nearEq:function(t,n,e){return r(t-n)<e},daysnap:function(n){let e=t.unix(n).utc();return e.hours(0),e.minutes(0),e.seconds(0),e.milliseconds(0),e.unix()},monthsnap:function(n){let e=t.unix(n).utc();return e.date(1).hours(0).minutes(0).seconds(0).milliseconds(0),e.unix()},yearsnap:function(n){let e=t.unix(n).utc();return e.month(0).date(1).hours(0).minutes(0).seconds(0).milliseconds(0),e.unix()},formatDate:N,dayparse:function(t,n=""){let e,r,u;return null==t?null:(""==n?(e=R,r=E):(e=RegExp("^(\\d{4})"+n+"(\\d{2})"+n+"(\\d{2})$"),r="YYYY"+n+"MM"+n+"DD"),(u="string"!=typeof t?null:t.match(e))?Date.UTC(u[1],u[2]-1,u[3])/1e3:isNaN(t)?NaN:Number(t))},dayify:function(n,e=""){if(isNaN(n)||n<0)return"ERROR";if(null==n)return null;let r=t.unix(n).utc(),u=r.year(),o=r.month()+1,i=r.date();return""+u+e+(o<10?"0":"")+o+e+(i<10?"0":"")+i},nowstamp:function(n,e,r){let u;if(n?t.hasOwnProperty("tz")?u=t().tz(n):(console.log("butil.nowstamp: moment-timezone is not loaded, using local time"),u=t()):(console.log("butil.nowstamp: no timezone specified, using local time"),u=t()),r){const n=t.unix(r).utc(),e=(t(u).utc()-n)/1e3;(e<0||e>2*c)&&u.year(n.year()).month(n.month()).date(n.date())}return u.subtract(e,"s"),u.format("YYYYMMDD")},loadJSON:function(t){return new Promise(function(n,e){""===t&&n(null);let r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.onreadystatechange=function(){if(4==r.readyState&&("200"==r.status||"0"==r.status&&""!=r.responseText))try{n(JSON.parse(r.responseText))}catch(e){console.log("butil.loadJSON: Could not parse JSON file in "+t),console.log(e.message),n(null)}else 4==r.readyState&&n(null)},r.open("GET",t,!0),r.send(null)})},toTitleCase:function(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},arrayEquals:function t(n,e){if(!(n instanceof Array&&e instanceof Array))return!1;if(n.length!=e.length)return!1;for(let r=0,u=n.length;r<u;r++)if(n[r]instanceof Array&&e[r]instanceof Array){if(!t(n[r],e[r]))return!1}else if(n[r]!==e[r])return!1;return!0},lineintersect:function(t,n,e,r){const u=n[0]-t[0],o=n[1]-t[1],i=-(r[0]-e[0]),l=-(r[1]-e[1]),f=e[0]-t[0],c=e[1]-t[1],s=u*l-i*o;if(0==s)return null;const a=(l*f-i*c)/s,d=(-o*f+u*c)/s;return a<0||a>1||d<0||d>1?null:[t[0]+a*u,t[1]+a*o]},lineval:function(t,n,e){var r=(n[1]-t[1])/(n[0]-t[0]);return t[1]+r*(e-t[0])}}});