!function(r,e){"use strict";"function"==typeof define&&define.amd?define(["moment"],e):"object"==typeof module&&module.exports?module.exports=e(require("./moment")):r.butil=e(r.moment)}(this,function(r){"use strict";const e=Math.min,t=Math.max,n=Math.abs,o=Math.pow,a=Math.log10,i=Math.floor,l=Math.round,u=86400;var s={MAXTIME:6e4,BBURL:"http://brain.beeminder.com/",Cols:{DYEL:"#ffff44",LYEL:"#ffff88",ROSE:"#ff8080",AKRA:"#4C4Cff",PURP:"#B56bb5",LPURP:"#E5BbE5",BLUE:"#EAEAFF",GRUE:"#b5ffDE",ORNG:"#ff8000",WITE:"#ffffff",BIGG:"#ffe54c",PINK:"#ffe5e5",PNKE:"#ffcccc",GRAY:"#f0f0f0",BLCK:"#000000",REDDOT:"#ff0000",ORNDOT:"#ffa500",BLUDOT:"#3f3fff",GRNDOT:"#00aa00",GRADOT:"#228B22",ERRDOT:"#00FFFF",RAZR0:"#ff0000",RAZR1:"#ffa500",RAZR2:"#3f3fff",RAZR3:"#6BC461"}};s.AKH=7*u,s.BDUSK=2147317201,s.SECS={y:31557600,m:2629800,w:7*u,d:u,h:3600},s.UNAM={y:"year",m:"month",w:"week",d:"day",h:"hour"},s.arrMin=(r=>e.apply(null,r)),s.arrMax=(r=>t.apply(null,r)),s.isArray=Array.isArray,s.extend=((r,e,t)=>{var n,o;for(n in e)(o=void 0!==r[n])&&"object"==typeof e[n]&&null!==e[n]&&void 0===e[n].nodeName?s.isArray(e[n])?t&&(r[n]=e[n].slice(0)):r[n]=s.extend({},e[n],t):!t&&o||(s.isArray(e[n])?r[n]=e[n].slice(0):r[n]=e[n]);return r}),s.deepcopy=(r=>{let e,t,n;if("object"!=typeof r||null===r)return r;for(n in e=Array.isArray(r)?[]:{},r)t=r[n],e[n]=s.deepcopy(t);return e}),s.argmax=((r,e)=>{if(null===e)return null;var t=e.map(r),n=s.arrMax(t);return e[t.findIndex(r=>r===n)]}),s.partition=((r,e,t)=>{var n=r.length,o=[];for(let a=0;a<n;a+=t)a+e<=n&&o.push(r.slice(a,a+e));return o}),s.modf=(r=>{var e=r<0?-r:r,t=i(e);return r<0?[-(e-t),-t]:[e-t,t]}),s.quantile=((r,e,t=1,n=!1)=>{var o;if(o=n?r:r.slice().sort((r,e)=>r-e),t<1||t>9)return null;var a=[[0,0,1,0],[.5,0,1,0],[.5,0,0,0],[0,0,0,1],[.5,0,0,1],[0,1,0,1],[1,-1,0,1],[1/3,1/3,0,1],[3/8,.25,0,1]],l=a[t-1][0],u=a[t-1][1],f=a[t-1][2],c=a[t-1][3],d=r.length,m=s.modf(l+(d+u)*e-1),p=m[0],h=m[1];return h<0?o[0]:h>=d?o[d-1]:(h=i(h),0==p?o[h]:o[h]+(o[h+1]-o[h])*(f+c*p))}),s.sum=(r=>r.reduce((r,e)=>r+e,0)),s.foldlist=((r,e,t)=>{var n=[e];for(let e=0;e<t.length;e++)n.push(r(n[e],t[e]));return n}),s.accumulate=(r=>{var e=r.length;if(0===e)return r;var t=[r[0]];for(let n=1;n<e;n++)t.push(t[t.length-1]+r[n]);return t}),s.monotonize=((r,n=1)=>{var o,a=r.slice();if(1===n)for(o=1;o<a.length;o++)a[o]=t(a[o-1],a[o]);else for(o=1;o<a.length;o++)a[o]=e(a[o-1],a[o]);return a}),s.zip=(r=>r[0].map((e,t)=>r.map(r=>r[t]))),s.chop=((r,e=1e-7)=>n(r)<e?0:r),s.ichop=((r,e=1e-7)=>{var t=r%1,n=r-t;return t<0&&(t+=1,n-=1),t>.5&&(t=1-s.chop(1-t)),i(n)+s.chop(t,e)}),s.clip=((r,e,t)=>{if(e>t){var n=e;e=t,t=n}return r<e&&(r=e),r>t&&(r=t),r}),s.searchby=((r,e)=>{const t=r.length;if(0===t)return null;let n,o=0,a=t-1,l=e(r[o]);if(l>0)return[null,0];let u,s=e(r[a]);if(s<0)return[t-1,null];for(;0!=l&&0!=s&&a-o>1;)(u=(n=i((o+a)/2))===o?l:e(r[n]))<=0?(o=n,l=u):(a=n,s=u);if(0!=l&&0!=s)return[o,a];for(a=o=0==l?o:a;o>0&&0==e(r[o-1]);)o-=1;for(;a<t-1&&0==e(r[a+1]);)a+=1;return[o,a]}),s.shn=((r,e=10,t=5,u=0)=>{if(isNaN(r))return r.toString();r=s.chop(r);let f,c,d=i(n(r));d=0===d?0:d.toString().length,n(r)>o(10,d)-.5&&(d+=1),f=0===d&&0!==r?i(t-a(n(r))):t;let m=r*o(10,f),p=m%10;p<0&&(p+=10),p>=4.5&&p<4.9999999&&(m=i(m));let h=l(m)/o(10,f)+1e-10;if(u<0&&h>r||u>0&&h<r){if(!(t>=10))return s.shn(r,e,t+1,u);h=r}return e<d&&n(o(10,d-1)-h)<.5&&(h=o(10,d-1)),e=s.clip(e,d,d+t),n(h)<1e-4||9===i(h)||99===i(h)||999===i(h)?c=parseFloat(r.toPrecision(f)).toString():(c=h.toPrecision(e)).includes("e")||(c=parseFloat(c)),c}),s.shd=(r=>null===r?"null":s.formatDate(r)),s.shdt=(r=>null===r?"null":s.formatDateTime(r)),s.splur=((r,e,t="")=>(""===t&&(t=e+"s"),s.shn(r,10,5)+" "+(1===r?e:t))),s.normberlize=(r=>{const e=(r="string"==typeof r?r.trim():r.toString()).charAt(0),t=r.substr(1);if("+"===e&&(r=t),"-"===e)return"-"+s.normberlize(t);r=r.replace(/^0+([^eE])/,"$1");if(/^(?:\d+\.?\d*|\.\d+)$/.test(r))return r;const n=r.match(/^(\d+\.?\d*|\.\d+)e([+-]?\d+)$/i);if(!n||3!==n.length)return"NaN";let[,o,a]=n,i=o.indexOf(".");return-1===i&&(i=o.length),i+=+a,o=o.replace(/\./,""),i<0?"."+"0".repeat(-i)+o:(i>o.length?o+="0".repeat(i-o.length):o=o.substring(0,i)+"."+o.substring(i),o.replace(/\.$/,"").replace(/^0+(.)/,"$1"))}),s.quantize=(r=>{let e=s.normberlize(r);return/^-?\d+\.?$/.test(e)?1:+(e=(e=(e=e.replace(/^-?\d*\./,".")).replace(/\d/g,"0")).replace(/0$/,"1"))}),s.round=((r,e=1)=>{if(e<0)return NaN;if(0===e)return+r;const t=l(r/e),n=e.toString().match(/^0?\.(0*)1$/);if(!n)return t*e;const o=-n[1].length-1;return+s.normberlize(`${t}e${o}`)}),s.conservaround=((r,e=1,t=0)=>{let n=s.round(r,e);return 0===t?n:(t<0&&n>r&&(n-=e),t>0&&n<r&&(n+=e),s.round(n,e))}),s.linspace=((r,e,n)=>{if(void 0===n&&(n=t(l(e-r)+1,1)),n<2)return 1===n?[r]:[];var o,a=Array(n);for(o=--n;o>=0;o--)a[o]=(o*e+(n-o)*r)/n;return a}),s.cvx=((r,n,o,a,i,l=!0)=>{var u;return 0===s.chop(n-o)?r<=n?e(a,i):t(a,i):0===s.chop(a-i)?a:l?s.clip(a+(r-n)/(o-n)*(i-a),a>i?i:a,a>i?a:i):(n>o&&(u=n,n=o,o=u),a>i&&(u=a,a=i,i=u),a+(r-n)/(o-n)*(i-a))}),s.deldups=((r,e=(r=>r))=>{let t={};return r.filter(r=>{const n=JSON.stringify(e(r));return!(n in t)&&(t[n]=!0)})}),s.orderedq=(r=>{for(let e=0;e<r.length-1;e++)if(r[e]>r[e+1])return!1;return!0}),s.nonzero=(r=>{var e,t=r.length;for(e=0;e<t;e++)if(0!==r[e])return!0;return!1}),s.clocky=(r=>{let e=0;for(let t=1;t<r.length;t+=2)e+=r[t]-r[t-1];return e}),s.mean=(r=>{var e,t=0,n=r.length;if(0==n)return 0;for(e=0;e<n;e++)t+=r[e];return t/r.length}),s.median=(r=>{var e=r.length;return r.sort((r,e)=>r-e),e%2==0?(r[e/2-1]+r[e/2])/2:r[(e-1)/2]}),s.mode=(r=>{if(!r||!r.length)return NaN;let e={},t=1,n=r[0];for(const o in r)e[r[o]]=(e[r[o]]||0)+1,e[r[o]]>t&&(t=e[r[o]],n=r[o]);return n}),s.trimmean=((r,e)=>{const t=Math.floor(r.length*e),n=r.sort((r,e)=>r-e).slice(t,r.length-t);return n.reduce((r,e)=>r+e)/n.length}),s.inrange=((r,e,t)=>r>=e&&r<=t),s.nearEq=((r,e,t)=>n(r-e)<t),s.addDays=((e,t)=>{var n=r(e);return n.add(t,"days"),n}),s.daysnap=(e=>{var t=r.unix(e).utc();return t.hours(0),t.minutes(0),t.seconds(0),t.milliseconds(0),t.unix()}),s.monthsnap=(e=>{var t=r.unix(e).utc();return t.date(1).hours(0).minutes(0).seconds(0).milliseconds(0),t.unix()}),s.yearsnap=(e=>{var t=r.unix(e).utc();return t.month(0).date(1).hours(0).minutes(0).seconds(0).milliseconds(0),t.unix()}),s.formatDate=(e=>{var t=r.unix(e).utc(),n=t.year(),o=t.month()+1;o=o<10?"0"+o.toString():o.toString();var a=t.date();return n+"."+o+"."+(a=a<10?"0"+a.toString():a.toString())}),s.formatDateTime=(e=>{var t=r.unix(e).utc(),n=t.hour();n=n<10?"0"+n.toString():n.toString();var o=t.minute();o=o<10?"0"+o.toString():o.toString();var a=t.second();return a=a<10?"0"+a.toString():a.toString(),s.formatDate(e)+" "+n+":"+o+":"+a});let f=RegExp("^(\\d{4})(\\d{2})(\\d{2})$");return s.dayparse=((r,e="")=>{let t,n,o;return null==r?null:(""==e?(t=f,n="YYYYMMDD"):(t=RegExp("^(\\d{4})"+e+"(\\d{2})"+e+"(\\d{2})$"),n="YYYY"+e+"MM"+e+"DD"),(o="string"!=typeof r?null:r.match(t))?Date.UTC(o[1],o[2]-1,o[3])/1e3:isNaN(r)?NaN:Number(r))}),s.dayify=((e,t="")=>{if(isNaN(e)||e<0)return"ERROR";if(null==e)return null;var n=r.unix(e).utc(),o=n.year(),a=n.month()+1,i=n.date();return""+o+t+(a<10?"0":"")+a+t+(i<10?"0":"")+i}),s.nowstamp=((e,t,n)=>{let o;if(e?r.hasOwnProperty("tz")?o=r().tz(e):(console.log("butil.nowstamp: moment-timezone is not loaded, using local time"),o=r()):(console.log("butil.nowstamp: no timezone specified, using local time"),o=r()),n){const e=r.unix(n).utc(),t=(r(o).utc()-e)/1e3;(t<0||t>2*u)&&o.year(e.year()).month(e.month()).date(e.date())}return o.subtract(t,"s"),o.format("YYYYMMDD")}),s.sint=(r=>l(r).toString()),s.loadJSON=(r=>new Promise(function(e,t){""===r&&e(null);var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.onreadystatechange=function(){if(4==n.readyState&&("200"==n.status||"0"==n.status&&""!=n.responseText))try{e(JSON.parse(n.responseText))}catch(t){console.log("butil.loadJSON: Could not parse JSON file in "+r),console.log(t.message),e(null)}else 4==n.readyState&&e(null)},n.open("GET",r,!0),n.send(null)})),s.toTitleCase=(r=>r.replace(/\w\S*/g,function(r){return r.charAt(0).toUpperCase()+r.substr(1).toLowerCase()})),s.arrayEquals=((r,e)=>{if(!(r instanceof Array&&e instanceof Array))return!1;if(r.length!=e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]instanceof Array&&e[t]instanceof Array){if(!s.arrayEquals(r[t],e[t]))return!1}else if(r[t]!==e[t])return!1;return!0}),s.nummy=(r=>!isNaN(parseFloat(r))&&isFinite(r)),s.stringy=(r=>"string"==typeof r),s.listy=(r=>Array.isArray(r)),s.torf=(r=>"boolean"==typeof r),s.born=(r=>s.torf(r)||null===r),s.norn=(r=>s.nummy(r)||null===r),s.timy=(r=>s.nummy(r)&&0<r&&r<s.BDUSK),s.torn=(r=>s.timy(r)||null===r),s.sorn=(r=>"string"==typeof r||null===r),s});