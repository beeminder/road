!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["moment"],t):"object"==typeof module&&module.exports?module.exports=t(require("./moment")):e.butil=t(e.moment)}(this,function(e){"use strict";const t=Math.min,r=Math.max,n=Math.abs,l=Math.pow,o=Math.log10,i=Math.floor,u=Math.round,a=86400;var s={MAXTIME:6e4,BBURL:"http://brain.beeminder.com/",Cols:{DYEL:"#ffff44",LYEL:"#ffff88",ROSE:"#ff8080",AKRA:"#4C4Cff",PURP:"#B56bb5",LPURP:"#E5BbE5",BLUE:"#EAEAFF",GRUE:"#b5ffDE",ORNG:"#ff8000",WITE:"#ffffff",BIGG:"#ffe54c",PINK:"#ffe5e5",PNKE:"#ffcccc",GRAY:"#f0f0f0",BLCK:"#000000",REDDOT:"#ff0000",ORNDOT:"#ffa500",BLUDOT:"#3f3fff",GRNDOT:"#00aa00",GRADOT:"#228B22",ERRDOT:"#00FFFF",RAZR0:"#ff0000",RAZR1:"#ffa500",RAZR2:"#3f3fff",RAZR3:"#6BC461"}};s.AKH=7*a,s.BDUSK=2147317201,s.SECS={y:31557600,m:2629800,w:7*a,d:a,h:3600},s.UNAM={y:"year",m:"month",w:"week",d:"day",h:"hour"},s.arrMin=(e=>t.apply(null,e)),s.arrMax=(e=>r.apply(null,e)),s.isArray=Array.isArray,s.extend=((e,t,r)=>{let n,l;for(n in t)(l=void 0!==e[n])&&"object"==typeof t[n]&&null!==t[n]&&void 0===t[n].nodeName?s.isArray(t[n])?r&&(e[n]=t[n].slice(0)):e[n]=s.extend({},t[n],r):!r&&l||(s.isArray(t[n])?e[n]=t[n].slice(0):e[n]=t[n]);return e}),s.deepcopy=(e=>{let t,r,n;if("object"!=typeof e||null===e)return e;for(n in t=Array.isArray(e)?[]:{},e)r=e[n],t[n]=s.deepcopy(r);return t}),s.argmax=((e,t)=>{if(null===t)return null;let r=t.map(e),n=s.arrMax(r);return t[r.findIndex(e=>e===n)]}),s.partition=((e,t,r)=>{let n=e.length,l=[];for(let o=0;o<n;o+=r)o+t<=n&&l.push(e.slice(o,o+t));return l}),s.modf=(e=>{let t=e<0?-e:e,r=i(t);return e<0?[-(t-r),-r]:[t-r,r]}),s.quantile=((e,t,r=1,n=!1)=>{let l;if(l=n?e:e.slice().sort((e,t)=>e-t),r<1||r>9)return null;let o=[[0,0,1,0],[.5,0,1,0],[.5,0,0,0],[0,0,0,1],[.5,0,0,1],[0,1,0,1],[1,-1,0,1],[1/3,1/3,0,1],[3/8,.25,0,1]],u=o[r-1][0],a=o[r-1][1],f=o[r-1][2],c=o[r-1][3],d=e.length,m=s.modf(u+(d+a)*t-1),h=m[0],p=m[1];return p<0?l[0]:p>=d?l[d-1]:(p=i(p),0==h?l[p]:l[p]+(l[p+1]-l[p])*(f+c*h))}),s.sum=(e=>e.reduce((e,t)=>e+t,0)),s.foldlist=((e,t,r)=>{let n=[t];for(let t=0;t<r.length;t++)n.push(e(n[t],r[t]));return n}),s.accumulate=(e=>{let t=e.length;if(0===t)return e;let r=[e[0]];for(let n=1;n<t;n++)r.push(r[r.length-1]+e[n]);return r}),s.monotonize=((e,n=1)=>{let l,o=e.slice();if(1===n)for(l=1;l<o.length;l++)o[l]=r(o[l-1],o[l]);else for(l=1;l<o.length;l++)o[l]=t(o[l-1],o[l]);return o}),s.zip=(e=>e[0].map((t,r)=>e.map(e=>e[r]))),s.chop=((e,t=1e-7)=>n(e)<t?0:e),s.ichop=((e,t=1e-7)=>{let r=e%1,n=e-r;return r<0&&(r+=1,n-=1),r>.5&&(r=1-s.chop(1-r)),i(n)+s.chop(r,t)}),s.clip=((e,t,r)=>(t>r&&([t,r]=[r,t]),e<t?t:e>r?r:e)),s.searchLow=((e,t)=>{if(!e||!e.length)return-1;let r,n=-1,l=e.length;for(;l-n>1;)t(e[r=i((n+l)/2)])<0?n=r:l=r;return l===e.length||0!==t(e[l])?n:l}),s.searchHigh=((e,t)=>{if(!e||!e.length)return 0;let r,n=-1,l=e.length;for(;l-n>1;)t(e[r=i((n+l)/2)])<=0?n=r:l=r;return-1===n||0!==t(e[n])?l:n}),s.shn=((e,t=10,r=5,a=0)=>{if(isNaN(e))return e.toString();e=s.chop(e);let f,c,d=i(n(e));d=0===d?0:d.toString().length,n(e)>l(10,d)-.5&&(d+=1),f=0===d&&0!==e?i(r-o(n(e))):r;let m=e*l(10,f),h=m%10;h<0&&(h+=10),h>=4.5&&h<4.9999999&&(m=i(m));let p=u(m)/l(10,f)+1e-10;if(a<0&&p>e||a>0&&p<e){if(!(r>=10))return s.shn(e,t,r+1,a);p=e}return t<d&&n(l(10,d-1)-p)<.5&&(p=l(10,d-1)),t=s.clip(t,d,d+r),n(p)<1e-4||9===i(p)||99===i(p)||999===i(p)?c=parseFloat(e.toPrecision(f)).toString():(c=p.toPrecision(t)).includes("e")||(c=parseFloat(c)),c}),s.shd=(e=>null===e?"null":s.formatDate(e)),s.shdt=(e=>null===e?"null":s.formatDateTime(e)),s.splur=((e,t,r="")=>(""===r&&(r=t+"s"),s.shn(e,10,5)+" "+(1===e?t:r))),s.normberlize=(e=>{const t=(e="string"==typeof e?e.trim():e.toString()).charAt(0),r=e.substr(1);if("+"===t&&(e=r),"-"===t)return"-"+s.normberlize(r);e=e.replace(/^0+([^eE])/,"$1");if(/^(?:\d+\.?\d*|\.\d+)$/.test(e))return e;const n=e.match(/^(\d+\.?\d*|\.\d+)e([+-]?\d+)$/i);if(!n||3!==n.length)return"NaN";let[,l,o]=n,i=l.indexOf(".");return-1===i&&(i=l.length),i+=+o,l=l.replace(/\./,""),i<0?"."+"0".repeat(-i)+l:(i>l.length?l+="0".repeat(i-l.length):l=l.substring(0,i)+"."+l.substring(i),l.replace(/\.$/,"").replace(/^0+(.)/,"$1"))}),s.quantize=(e=>{let t=s.normberlize(e);return/^-?\d+\.?$/.test(t)?1:+(t=(t=(t=t.replace(/^-?\d*\./,".")).replace(/\d/g,"0")).replace(/0$/,"1"))}),s.round=((e,t=1)=>{if(t<0)return NaN;if(0===t)return+e;const r=u(e/t),n=t.toString().match(/^0?\.(0*)1$/);if(!n)return r*t;const l=-n[1].length-1;return+s.normberlize(`${r}e${l}`)}),s.conservaround=((e,t=1,r=0)=>{let n=s.round(e,t);return 0===r?n:(r<0&&n>e&&(n-=t),r>0&&n<e&&(n+=t),s.round(n,t))}),s.linspace=((e,t,n)=>{if(void 0===n&&(n=r(u(t-e)+1,1)),n<2)return 1===n?[e]:[];let l,o=Array(n);for(l=--n;l>=0;l--)o[l]=(l*t+(n-l)*e)/n;return o}),s.rescale=((e,t,r,l,o)=>n(t-r)<1e-7?e<=(t+r)/2?l:o:l+(e-t)/(r-t)*(o-l)),s.deldups=((e,t=(e=>e))=>{let r={};return e.filter(e=>{const n=JSON.stringify(t(e));return!(n in r)&&(r[n]=!0)})}),s.orderedq=(e=>{for(let t=0;t<e.length-1;t++)if(e[t]>e[t+1])return!1;return!0}),s.nonzero=(e=>{let t,r=e.length;for(t=0;t<r;t++)if(0!==e[t])return!0;return!1}),s.clocky=(e=>{let t=0;for(let r=1;r<e.length;r+=2)t+=e[r]-e[r-1];return t}),s.mean=(e=>{let t,r=0,n=e.length;if(0==n)return 0;for(t=0;t<n;t++)r+=e[t];return r/e.length}),s.median=(e=>{let t=0,r=e.length;return e.sort((e,t)=>e-t),t=r%2==0?(e[r/2-1]+e[r/2])/2:e[(r-1)/2]}),s.mode=(e=>{if(!e||!e.length)return NaN;let t={},r=1,n=e[0];for(const l in e)t[e[l]]=(t[e[l]]||0)+1,t[e[l]]>r&&(r=t[e[l]],n=e[l]);return n}),s.trimmean=((e,t)=>{const r=Math.floor(e.length*t),n=e.sort((e,t)=>e-t).slice(r,e.length-r);return n.reduce((e,t)=>e+t)/n.length}),s.inrange=((e,t,r)=>e>=t&&e<=r),s.nearEq=((e,t,r)=>n(e-t)<r),s.addDays=((t,r)=>{let n=e(t);return n.add(r,"days"),n}),s.daysnap=(t=>{let r=e.unix(t).utc();return r.hours(0),r.minutes(0),r.seconds(0),r.milliseconds(0),r.unix()}),s.monthsnap=(t=>{let r=e.unix(t).utc();return r.date(1).hours(0).minutes(0).seconds(0).milliseconds(0),r.unix()}),s.yearsnap=(t=>{let r=e.unix(t).utc();return r.month(0).date(1).hours(0).minutes(0).seconds(0).milliseconds(0),r.unix()}),s.formatDate=(t=>{let r=e.unix(t).utc(),n=r.year(),l=r.month()+1;l=l<10?"0"+l.toString():l.toString();let o=r.date();return n+"."+l+"."+(o=o<10?"0"+o.toString():o.toString())}),s.formatDateTime=(t=>{let r=e.unix(t).utc(),n=r.hour();n=n<10?"0"+n.toString():n.toString();let l=r.minute();l=l<10?"0"+l.toString():l.toString();let o=r.second();return o=o<10?"0"+o.toString():o.toString(),s.formatDate(t)+" "+n+":"+l+":"+o});let f=RegExp("^(\\d{4})(\\d{2})(\\d{2})$");return s.dayparse=((e,t="")=>{let r,n,l;return null==e?null:(""==t?(r=f,n="YYYYMMDD"):(r=RegExp("^(\\d{4})"+t+"(\\d{2})"+t+"(\\d{2})$"),n="YYYY"+t+"MM"+t+"DD"),(l="string"!=typeof e?null:e.match(r))?Date.UTC(l[1],l[2]-1,l[3])/1e3:isNaN(e)?NaN:Number(e))}),s.dayify=((t,r="")=>{if(isNaN(t)||t<0)return"ERROR";if(null==t)return null;let n=e.unix(t).utc(),l=n.year(),o=n.month()+1,i=n.date();return""+l+r+(o<10?"0":"")+o+r+(i<10?"0":"")+i}),s.nowstamp=((t,r,n)=>{let l;if(t?e.hasOwnProperty("tz")?l=e().tz(t):(console.log("butil.nowstamp: moment-timezone is not loaded, using local time"),l=e()):(console.log("butil.nowstamp: no timezone specified, using local time"),l=e()),n){const t=e.unix(n).utc(),r=(e(l).utc()-t)/1e3;(r<0||r>2*a)&&l.year(t.year()).month(t.month()).date(t.date())}return l.subtract(r,"s"),l.format("YYYYMMDD")}),s.sint=(e=>u(e).toString()),s.loadJSON=(e=>new Promise(function(t,r){""===e&&t(null);let n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.onreadystatechange=function(){if(4==n.readyState&&("200"==n.status||"0"==n.status&&""!=n.responseText))try{t(JSON.parse(n.responseText))}catch(r){console.log("butil.loadJSON: Could not parse JSON file in "+e),console.log(r.message),t(null)}else 4==n.readyState&&t(null)},n.open("GET",e,!0),n.send(null)})),s.toTitleCase=(e=>e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})),s.arrayEquals=((e,t)=>{if(!(e instanceof Array&&t instanceof Array))return!1;if(e.length!=t.length)return!1;for(let r=0,n=e.length;r<n;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!s.arrayEquals(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0}),s.nummy=(e=>!isNaN(parseFloat(e))&&isFinite(e)),s.stringy=(e=>"string"==typeof e),s.listy=(e=>Array.isArray(e)),s.torf=(e=>"boolean"==typeof e),s.born=(e=>s.torf(e)||null===e),s.norn=(e=>s.nummy(e)||null===e),s.timy=(e=>s.nummy(e)&&0<e&&e<s.BDUSK),s.torn=(e=>s.timy(e)||null===e),s.sorn=(e=>"string"==typeof e||null===e),s});