((n,t)=>{"use strict";"function"==typeof define&&define.amd?define(["moment","butil","broad"],t):"object"==typeof module&&module.exports?module.exports=t(require("./moment"),require("./butil"),require("./broad")):n.beebrain=t(n.moment,n.butil,n.broad)})(this,(n,t,r)=>{"use strict";const a=Math.max,i=Math.min,e=Math.abs,l=Math.exp,o=Math.floor,s=Math.ceil,u=Math.sign,f=365.25,m=86400;let d=1;const c={quantum:1e-5,timey:!1,ppr:!0,deadline:0,sadlhole:!0,asof:null,tini:null,vini:null,road:[],tfin:null,vfin:null,rfin:null,runits:"w",gunits:"units",yaw:0,dir:0,pinkzone:[],tmin:null,tmax:null,vmin:null,vmax:null,kyoom:!1,odom:!1,maxflux:0,monotone:!1,aggday:null,plotall:!0,steppy:!1,rosy:!1,movingav:!1,aura:!1,hashtags:!0,yaxis:"",waterbuf:null,waterbux:"",hidey:!1,stathead:!0,imgsz:760,yoog:"U/G",usr:null,graph:null,goal:null,rate:null},p={sadbrink:!1,safebump:null,dueby:[],fullroad:[],pinkzone:[],tluz:null,tcur:null,vcur:null,vprev:null,rcur:null,ravg:null,tdat:null,stdflux:0,delta:0,lane:666,cntdn:0,numpts:0,mean:0,meandelt:0,proctm:0,statsum:"",ratesum:"",deltasum:"",graphsum:"",progsum:"",rah:0,safebuf:null,error:"",limsum:"",headsum:"",titlesum:"",lnw:0,color:"black",loser:!1,gldt:null,goal:null,rate:null,road:[],tini:null,vini:null,tfin:null,vfin:null,rfin:null},g=["ybhp","integery","noisy","abslnw","tagtime","timezone","backroad","edgy","offred"],h={AGGPAST:0,AGGFUTURE:1,RAWPAST:2,RAWFUTURE:3,FLATLINE:4,HOLLOW:5};return function(y){let v=this,b=d;d++,y=t.deepcopy(y);let x=[],w={},A=[],z=[],R=[],k=[],M=[],T=[],E=[],S={},U={},G={},O={},P=[];w.yaw=1,w.dir=1,w.tcur=0,w.vcur=0,w.vprev=0;const N=n.utc();function L(n){if(n.fullroad=n.fullroad.map(n=>(function(n){return Array.isArray(n)?n.length<=3?n:n.slice(0,3):n})(n)),n.road=n.fullroad,n.error)n.gldt=t.dayify(w.tfin),n.goal=w.vfin,n.rate=w.rfin*w.siru;else{const t=n.fullroad.length;t>0&&(n.gldt=n.fullroad[t-1][0],n.goal=n.fullroad[t-1][1],n.rate=n.fullroad[t-1][2])}n.tini=t.dayify(w.tini),n.vini=w.vini,n.tfin=t.dayify(w.tfin),n.vfin=w.vfin,n.rfin=w.rfin}function D(n){return Array.isArray(n)&&3===n.length?[t.dayparse(n[0]),n[1],n[2]]:n}function K(n){if(n.length<1)return n;let r=n.slice();return r[0]=t.dayify(n[0]),r}function $(n,t){let r=.25/m;"meta/derev"===w.yoog&&(r=.03/m),"meta/dpledge"===w.yoog&&(r=.03/m);let a,i,e,o,s,u=n[0][0],f=n[0][1],d=f;if(t<u)return d;for(e=1;e<n.length;e++){if(a=(i=n[e])[0]-u,o=(i[1]-f)/a,s=f,t<i[0])return s+o*(a=t-u)-o/r+(d-s+o/r)*l(-r*a);d=s+o*a-o/r+(d-s+o/r)*l(-r*a),u=i[0],f=i[1]}return s+o*(a=t-u)-o/r+(d-s+o/r)*l(-r*a)}function F(n,r,a){let i=t.zip(n);return i[1]=function(n,r,a){return t.foldlist((n,a)=>t.clip(n,a-r,a+r),n[0]+a*r,n.slice(1,n.length))}(i[1],r,a),t.zip(i)}function H(n,t,r){return F(n.slice().reverse(),t,r).reverse()}let j;N.hour(0),N.minute(0),N.second(0),N.millisecond(0),w.asof=N.unix(),w.horizon=w.asof+t.AKH,w.xMin=w.asof,w.xMax=w.horizon,w.yMin=-1,w.yMax=1;try{j=new RegExp("(?:^|\\s)(#\\p{L}[\\p{L}0-9_]*)(?=$|\\s)","gu")}catch{j=/(?:^|\s)(#[a-zA-Z]\w*)(?=$|\s)/g}function q(n){let t,r=new Set;for(j.lastIndex=0;null!=(t=j.exec(n));)""!=t[1]&&r.add(t[1]);return r}function B(n){return n[1]}function I(n,r){const a=w.kyoom&&"sum"===w.aggday;if(1===n.length)return[n[0][2],n[0][3],n[0][4]];{let i;return(i=a?t.accumulate(n.map(B)).indexOf(r):n.map(B).indexOf(r))<0?[w.aggday,null,null]:[n[i][1]+" ("+w.aggday+")",n[i][3],n[i][4]]}}let C=null;function W(n){return JSON.stringify(null==n[0]?n:[t.formatDate(n[0]),n[1],n[2]])}const J=[["deadline",n=>-64800<=n&&n<=21600,"outside 6am earlybird to 6am nightowl"],["asof",n=>null!=n,"can't be null! Tell support!"],["asof",t.torn,"isn't a valid timestamp"],["tini",t.timy,"isn't a valid timestamp"],["vini",t.nummy,"isn't numeric"],["road",t.listy,"(road matrix) isn't a list"],["tfin",t.torn,"isn't a valid timestamp"],["vfin",t.norn,"isn't numeric or null"],["rfin",t.norn,"isn't numeric or null"],["runits",n=>n in t.SECS,"isn't a valid rate unit"],["yaw",n=>0==n||1==n||-1==n,"isn't in [0,-1,1]"],["dir",n=>1==n||-1==n,"isn't in -1,1]"],["tmin",t.torn,"isn't a number/timestamp"],["tmax",t.torn,"isn't a valid timestamp"],["vmin",t.norn,"isn't numeric or null"],["vmax",t.norn,"isn't numeric or null"],["kyoom",t.torf,"isn't boolean"],["odom",t.torf,"isn't boolean"],["monotone",t.torf,"isn't boolean"],["aggday",n=>n in r.AGGR,"isn't one of max, sum, last, mean, etc"],["plotall",t.torf,"isn't boolean"],["steppy",t.torf,"isn't boolean"],["rosy",t.torf,"isn't boolean"],["movingav",t.torf,"isn't boolean"],["aura",t.torf,"isn't boolean"],["yaxis",t.stringy,"isn't a string"],["yaxis",n=>n.length<80,"string is too long\\n"],["waterbuf",t.sorn,"isn't a string or null"],["waterbux",t.stringy,"isn't a string"],["hidey",t.torf,"isn't boolean"],["stathead",t.torf,"isn't boolean"],["imgsz",t.nummy,"isn't numeric"],["yoog",t.stringy,"isn't a string"]];function Y(){w.dtf=r.stepify(z),w.road=r.fillroad(w.road,w);const n=w.road.length;w.tfin=w.road[n-1][0],w.vfin=w.road[n-1][1],w.rfin=w.road[n-1][2];const e=w.road.map(n=>n[0]);if(w.tini>e[0])return"Road dial error\\n(There are segments of your yellow brick road\\nthat are somehow dated before your road start date!)";if(!t.orderedq(e))return"Road dial error\\n(Your goal date, goal "+(w.kyoom?"total":"value")+", and rate are inconsistent!\\nIs your rate positive when you meant negative?\\nOr is your goal "+(w.kyoom?"total":"value")+" such that the implied goal date is in the past?)";w.stdflux=r.stdflux(x,z.filter(n=>n[0]>=w.tini)),function(){const n=w.asof,a=z.length,e=z[a-1][0],l=z[a-1][1];if(e>w.tfin)return;let o=e;if(w.yaw*w.dir<0)o=i(n,w.tfin);else{let e,s=null;for(;o<=i(n,w.tfin)&&(s!==(e=r.dotcolor(x,w,o,l,w.isolines))||s!==t.Cols.REDDOT);)s=e,o+=m;o=i(o,n,w.tfin);for(let n=0;n<a;n++)if(o==z[n][0])return}if(!(o in U)){const n=z[a-1];C=[o,l,"PPR",h.FLATLINE,n[0],n[1],null],z.push(C)}}();const l=z.length;if(w.movingav)if(l<=1||z[l-1][0]-z[0][0]<=0)w.filtpts=[];else{const n=function(n,r,a=6e3){return t.linspace(n,r,o(t.clip((r-n)/(m+1),i(600,640),a)))}(z[0][0],z[l-1][0],4*(z[l-1][0]-z[0][0])/m);JSON.stringify(n),w.filtpts=n.map(n=>[n,$(z,n)])}else w.filtpts=[];return w.tcur=z[l-1][0],w.vcur=z[l-1][1],w.vprev=z[a(l-2,0)][1],w.safebuf=r.dtd(x,w,w.tcur,w.vcur),w.tluz=w.tcur+w.safebuf*m,w.delta=t.chop(w.vcur-r.rdf(x,w.tcur)),w.rah=r.rdf(x,w.tcur+t.AKH),w.dueby=r.dueby(x,w,7),w.safebump=r.lim(x,w,w.safebuf),w.rcur=r.rtf(x,w.tcur)*w.siru,w.ravg=r.tvr(w.tini,w.vini,w.tfin,w.vfin,null)*w.siru,w.cntdn=s((w.tfin-w.tcur)/m),w.lane=w.yaw*(w.safebuf-(w.safebuf<=1?2:1)),w.color=w.safebuf<1?"red":w.safebuf<2?"orange":w.safebuf<3?"blue":"green",w.loser=r.redyest(x,w,w.tcur),w.sadbrink=w.tcur-m>w.tini&&r.dotcolor(x,w,w.tcur-m,w.dtf(w.tcur-m,w.isolines))==t.Cols.REDDOT,w.safebuf<=0&&(w.tluz=w.tcur),w.tfin<w.tluz&&(w.tluz=t.BDUSK),function(){if(null==w.tmin&&(w.tmin=i(w.tini,w.asof)),null==w.tmax){const n=o((w.tcur-w.tmin)/(f*m));w.tmax=t.daysnap(2*(1+n/2)*t.AKH+w.tcur)}if(null!=w.vmin&&null!=w.vmax)return void(w.vmin==w.vmax?(w.vmin-=1,w.vmax+=1):w.vmin>w.vmax&&([w.vmin,w.vmax]=[w.vmax,w.vmin]));const n=r.rdf(x,w.tmin),e=r.rdf(x,w.tmax),l=z.filter(n=>n[0]<=w.tmax&&n[0]>=w.tmin).map(n=>n[1]);let s=t.arrMin(l),u=t.arrMax(l);if(null!=C&&C[0]<=w.tmax&&C[0]>=w.tmin){const n=C[1]+r.ppr(x,w,w.asof);s=i(s,n),u=a(u,n)}const d=a(0,.015*(u-s)*2);let c=s-d,p=u+d;w.monotone&&w.dir>0?(c=t.arrMin([c,n,e]),p=t.arrMax([p,n,e])):(w.monotone&&w.dir,c=t.arrMin([c,n,e]),p=t.arrMax([p,n,e])),w.plotall&&w.tmin<=w.tini&&w.tini<=w.tmax&&w.tini in S&&(c=i(c,t.arrMin(S[w.tini].map(n=>n[1]))),p=a(p,t.arrMax(S[w.tini].map(n=>n[1])))),null==w.vmin&&null==w.vmax?(w.vmin=c,w.vmax=p,w.vmin==w.vmax?(w.vmin-=1,w.vmax+=1):w.vmin>w.vmax&&([w.vmin,w.vmax]=[w.vmax,w.vmin])):null==w.vmin?w.vmin=c<w.vmax?c:w.vmax-1:null==w.vmax&&(w.vmax=p>w.vmin?p:w.vmin+1)}(),""}this.reloadRoad=function(){const n=Y();if(""!=n)return n;if(function(n,a){const i=a.yaw,l=a.dir,s=a.lane,f=a.delta,d=a.quantum,c=i>0&&l>0,p=i<0&&l<0,g=i<0&&l>0,h=i>0&&l<0,y=(n,r=i,a=4,e=2)=>null===d?t.shn(n,a,e,r):t.conservaround(n,d,r),v=(n,t=i,r=4,a=2)=>(n>=0?"+":"")+y(n,t,r,a);if(""!=a.error)return void(a.statsum=" error:    "+a.error+"\\n");const b=t.zip(a.road)[2];let w=t.arrMin(b),A=t.arrMax(b);if(e(w)>e(A)){const n=w;w=A,A=n}const R=t.shn(w,4,2),k=t.shn(A,4,2),M=t.shn(a.ravg,4,2),T=t.shn(a.rcur,4,2);a.ratesum=(w===A?R:"between "+R+" and "+k)+" per "+t.UNAM[a.runits]+(w!==A?" (current: "+T+", average: "+M+")":"");const E=t.daysnap(a.tini),S=t.daysnap(a.tcur),U=t.daysnap(a.tfin),G=a.vini,O=a.vcur,P=a.vfin;let N,L,D,K;N=E===U?"??":t.shn(t.rescale(S,E,U,0,100),1,1),L=G===P?O<G&&a.yaw>0||O>G&&a.yaw<0?"00":"100":e(G-P)<1e-7?O<(G+P)/2&&a.yaw>0||O>(G+P)/2&&a.yaw<0?"~0":"~100":t.shn(t.rescale(a.vcur,a.vini,a.vfin,0,100),1,1),a.progsum=N==L?N+"% done":N+"% done by time -- "+L+"% by value",a.cntdn<7?(D=u(a.rfin)*(a.vfin-a.vcur),K="To go to goal: "+y(D,0,2,1)+"."):K="Yellow Brick Rd = "+((D=r.rdf(x,a.tcur+a.siru)-r.rdf(x,a.tcur))>=0?"+":"")+t.shn(D,2,1,0)+" / "+t.UNAM[a.runits]+".",a.graphsum=y(a.vcur,0,3,1)+" on "+t.shd(a.tcur)+" ("+t.splur(a.numpts,"datapoint")+" in "+t.splur(1+o((a.tcur-a.tini)/m),"day")+") targeting "+y(a.vfin,0,3,1)+" on "+t.shd(a.tfin)+" ("+t.splur(a.cntdn,"more day")+"). "+K,a.deltasum=y(e(f),0)+" "+a.gunits+(f<0?" below":" above")+" the bright line";const $=a.safebuf,F=t.splur($,"day"),H=r.lim(x,a,c||p?$:0),j=r.limd(x,a,c||p?$:0);a.kyoom?(c&&(a.limsum=v(j)+" in "+F),p&&(a.limsum=v(j)+" in "+F),g&&(a.limsum=v(j)+" today"),h&&(a.limsum=v(j)+" today")):(c&&(a.limsum=v(j)+" in "+F+" ("+y(H)+")"),p&&(a.limsum=v(j)+" in "+F+" ("+y(H)+")"),g&&(a.limsum=v(j)+" today ("+y(H)+")"),h&&(a.limsum=v(j)+" today ("+y(H)+")")),a.safeblurb=i*l<0?"unknown days of safety buffer":$>999?"more than 999 days of safety buffer":"~"+F+" of safety buffer",a.titlesum=t.toTitleCase(a.color)+": bmndr.com/"+a.yoog+" is safe for ~"+F+(0===$?" (beemergency!)":""),a.headsum=a.titlesum,a.statsum=" progress: "+t.shd(a.tini)+"  "+(null==z?"?":t.shn(a.vini,4,2,0))+"\\n           "+t.shd(a.tcur)+"  "+t.shn(a.vcur,4,2,0)+"   ["+a.progsum+"]\\n           "+t.shd(a.tfin)+"  "+t.shn(a.vfin,4,2,0)+"\\n rate:     "+a.ratesum+"\\n lane:     "+(666==e(s)?"n/a":s)+"\\n safebuf:  "+a.safebuf+"\\n delta:    "+a.deltasum+"\\n ",a.statsum+=0==i?"limit:    ":i<0?"hard cap: ":"bare min: ",a.statsum+=a.limsum+"\\n"}(0,w),w.fullroad=w.road.slice(),w.fullroad.unshift([w.tini,w.vini,0,0]),""==w.error&&(w.pinkzone=[[w.asof,r.rdf(x,w.asof),0]],w.road.forEach(function(n){n[0]>w.asof&&n[0]<w.asof+t.AKH&&w.pinkzone.push([n[0],n[1],null])}),w.pinkzone.push([w.asof+t.AKH,r.rdf(x,w.asof+t.AKH),null]),w.pinkzone=r.fillroadall(w.pinkzone,w)),w.aura){const n=z.filter(n=>n[0]>=w.tmin),t=r.gapFill(n);w.auraf=r.smooth(t)}else w.auraf=(n=>0);w.dtdarray=r.dtdarray(x,w),w.isolines=[];for(let n=0;n<4;n++)w.isolines[n]=r.isoline(x,w.dtdarray,w,n);return""};let V={};this.getStats=function(){return t.deepcopy(V)},this.setRoadObj=function(n){if(0!=n.length){x=n,v.roads=x,w.road=[];for(let n=1;n<x.length;n++)w.road.push([x[n].sta[0],x[n].sta[1],x[n].slope]);v.gol=w,v.reloadRoad()}else console.log("id="+b+", setRoadObj(), null road!")},function(e,l,o=null){try{null==o&&(o=n.utc().unix()),function(n){"goal"in n&&!("vfin"in n)&&(n.vfin=n.goal),"rate"in n&&!("rfin"in n)&&(n.rfin=n.rate),"usr"in n&&"graph"in n&&!("yoog"in n)&&(n.yoog=n.usr+"/"+n.graph)}(e),function(){z=[],C=null,k=[],S={},U={},G={},(w={}).siru=null,M=[],T=[],O={};for(const n in p)w[n]=p[n];for(const n in c)w[n]=c[n]}(),w.proctm=o,z=function(n,r){return["asof","tini","tfin","tmin","tmax"].map(r=>{r in n&&(n[r]=t.dayparse(n[r]))}),"road"in n&&t.listy(n.road)&&(n.road=n.road.map(D)),r.map((n,r)=>[t.dayparse(n[0]),n[1],n[2],r,n[1]]).sort((n,t)=>n[0]!==t[0]?n[0]-t[0]:n[3]-t[3])}(e,l);const s=[];for(const n in e)n in e&&(n in c||g.includes(n)?w[n]=e[n]:s.push(`${n}=${e[n]}`));s.length>0&&(w.error+=`Unknown param${1===s.length?"":"s"}: ${s.join(", ")}`),"aggday"in e||(e.aggday=w.kyoom?"sum":"last"),w.siru=t.SECS[w.runits],w.horizon=w.asof+t.AKH,w.waterbuf0=w.waterbuf,t.listy(w.road)&&w.road.push([w.tfin,w.vfin,w.rfin]),""==w.error&&(w.error=function(){const n=n=>JSON.stringify(n);let r;for(r=0;r<J.length;r++){const t=J[r];if(!t[1](w[t[0]]))return`'${t[0]}' ${t[2]}: ${n(w[t[0]])}`}const a=w.road;for(r=0;r<a.length;r++)if(i=a[r],!t.listy(i)||3!=i.length||!(null==i[0]&&t.nummy(i[1])&&t.nummy(i[2])||t.nummy(i[0])&&null==i[1]&&t.nummy(i[2])||t.nummy(i[0])&&t.nummy(i[1])&&null==i[2]))return"Invalid road matrix row: "+W(a[r]);var i;const e=a.slice(1,a.length-1);if(e.length!=t.deldups(e).length){let n=e[0];for(r=1;r<e.length;r++){if(t.arrayEquals(e[r],n))return"Road matrix has duplicate row: "+W(e[r]);n=e[r]}return"Road matrix duplicate row error! Tell support!"}return w.kyoom&&w.odom?"The odometer setting doesn't make sense for an auto-summing goal!":""}()),""==w.error&&(w.error=function(){if(null==z||0==z.length)return"No datapoints";const n=z.length;let a,i;for(a=0;a<n;a++){if(i=z[a],!(t.nummy(i[0])&&i[0]>0&&t.nummy(i[1])&&t.stringy(i[2])))return"Invalid datapoint: "+i[0]+" "+i[1]+' "'+i[3];if(w.hashtags){const n=q(i[2]);if(0==n.size)continue;i[0]in O||(O[i[0]]=new Set);for(const t of n)O[i[0]].add(t)}}if(w.hashtags){P=[],Object.keys(O);for(const n in O)P.push([n,Array.from(O[n]).join(" ")])}for(T=(T=z.filter(n=>(function(n){return n.startsWith("RECOMMITTED")})(n[2]))).map(n=>n.slice()),a=0;a<T.length;a++){const n=1562299200;T[a][0]<n&&(T[a][0]=T[a][0]-m)}w.odom&&(M=z.filter(n=>0==n[1]).map(n=>n[0]),r.odomify(z));const e=z.filter(n=>n[0]<=w.asof);w.plotall&&(w.numpts=e.length),S={},U={};let l,o=[],s=z[0][0],u=[],f=0;for(r.rsk8=w.rfin*m/w.siru,a=0;a<=z.length;a++)if(a<z.length&&z[a][0]==s&&u.push(z[a].slice()),a>=z.length||z[a][0]!=s){let n=u.map(B),i=r.AGGR[w.aggday](n);l=o.length>0?o[o.length-1]:[s,i+f];let e=I(u,i);o.push([s,f+i,e[0],s<=w.asof?h.AGGPAST:h.AGGFUTURE,l[0],l[1],e[2],e[1]]),w.kyoom?("sum"===w.aggday?S[s]=t.accumulate(n).map((n,t)=>[s,n+f,u[t][2],u[t][3],u[t][4]]):S[s]=u.map(n=>[s,n[1]+f,n[2],n[3],n[4]]),U[s]=f+i,f+=i):(S[s]=u,U[s]=i);const m=S[s].map(n=>n[1]);G[s]=w.yaw<0?t.arrMax(m):t.arrMin(m),a<z.length&&(s=z[a][0],u=[z[a].slice()])}let d=[];for(let n in S)d=d.concat(S[n].map(t=>[Number(n),t[1],t[2],Number(n)<=w.asof?h.AGGPAST:h.AGGFUTURE,null,null,t[4],t[3]]));if(A=d,k=o.filter(n=>n[0]>w.asof),0==(z=o.filter(n=>n[0]<=w.asof)).length)return"All datapoints are in the future!";w.plotall||(w.numpts=z.length);const c=r.gapFill(z).map(n=>n[1]);for(z.length>0&&(w.mean=t.mean(c)),z.length>1&&(w.meandelt=t.mean(t.partition(c,2,1).map(n=>n[1]-n[0]))),w.tdat=z[z.length-1][0],a=0;a<T.length;a++){const n=1562299200;(s=T[a][0]<n?T[a][0]+m:T[a][0])in G&&(T[a][1]=U[s])}return E=z.filter(n=>n[0]in S&&n[0]<w.asof&&!S[n[0]].map(n=>n[1]).includes(n[1])),""}()),""==w.error&&(w.error=function(n){const a=t.BDUSK;x=[];const e=n,l=e.length;let o,s=w.tini,u=w.vini;null!=e[0][0]&&e[0][0]<s&&(s=e[0][0],null!=e[0][1]&&(u=e[0][1])),(o={sta:[s,Number(u)],slope:0,auto:r.RP.SLOPE}).end=o.sta.slice(),o.sta[0]=t.daysnap(o.sta[0]-100*m*f),x.push(o);for(let n=0;n<l;n++){let t={};t.sta=x[x.length-1].end.slice();let l=null,o=null,s=null;l=e[n][0],o=e[n][1],s=e[n][2],null==l?(t.end=[0,Number(o)],t.slope=Number(s)/w.siru,0!=t.slope?t.end[0]=t.sta[0]+(t.end[1]-t.sta[1])/t.slope:(t.end[0]=a,t.end[1]=t.sta[1]),t.end[0]=i(a,t.end[0]),t.end[1]=t.sta[1]+t.slope*(t.end[0]-t.sta[0]),t.auto=r.RP.DATE):null==o?(t.end=[l,0],t.slope=Number(s)/w.siru,t.end[1]=t.sta[1]+t.slope*(t.end[0]-t.sta[0]),t.auto=r.RP.VALUE):null==s&&(t.end=[l,Number(o)],t.slope=r.segSlope(t),t.auto=r.RP.SLOPE),t.end[0]>=t.sta[0]&&x.push(t)}const d=x[x.length-1],c={sta:d.end.slice(),end:d.end.slice(),slope:0,auto:r.RP.VALUE};return c.end[0]=t.daysnap(c.end[0]+100*m*f),x.push(c),""}(e.road)),""==w.error&&(w.error=v.reloadRoad()),function(){if(!w.rosy||0==z.length)return;const n=a(0,w.stdflux);let r,i;w.dir>0?(r=F(z,n,-1),i=H(z,n,1)):(r=H(z,n,-1),i=F(z,n,1));const e=r.map(n=>n[1]),l=i.map(n=>n[1]),o=t.zip([e,l]).map(n=>(n[0]+n[1])/2),s=z.map(n=>n[0]);R=(R=t.zip([s,o])).map(n=>[n[0],n[1],"rosy data",h.RAWPAST,n[0],n[1],n[1]]);for(let n=1;n<R.length-1;n++)R[n][4]=R[n-1][0],R[n][5]=R[n-1][1]}()}finally{V=Object.assign({},p);for(const n in V)V[n]=w[n];!function(n){n.fullroad=n.fullroad.map(K),"razrmatr"in p&&(n.razrmatr=n.razrmatr.map(K)),n.pinkzone=n.pinkzone.map(K),n.tluz=t.dayify(n.tluz),n.tcur=t.dayify(n.tcur),n.tdat=t.dayify(n.tdat)}(V),L(V)}}(y.params,y.data),w.graphurl=t.BBURL,w.thumburl=t.BBURL,this.id=b,this.DPTYPE=h,this.roads=x,this.gol=w,this.data=z,this.rosydata=R,this.alldata=A,this.allvals=S,this.fuda=k,this.flad=C,this.oresets=M,this.derails=T,this.hollow=E,this.hashtags=P}});