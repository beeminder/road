((n,t)=>{"use strict";"function"==typeof define&&define.amd?define(["moment","butil","broad"],t):"object"==typeof module&&module.exports?module.exports=t(require("./moment"),require("./butil"),require("./broad")):n.beebrain=t(n.moment,n.butil,n.broad)})(this,(n,t,r)=>{"use strict";const i=Math.max,a=Math.min,e=Math.abs,l=Math.exp,o=Math.floor,s=Math.ceil,u=Math.sign,f=365.25,m=86400;let d=1;const c={quantum:1e-5,timey:!1,ppr:!0,deadline:0,sadlhole:!0,asof:null,tini:null,vini:null,road:[],tfin:null,vfin:null,rfin:null,runits:"w",gunits:"units",yaw:0,dir:0,pinkzone:[],tmin:null,tmax:null,vmin:null,vmax:null,kyoom:!1,odom:!1,maxflux:0,monotone:!1,aggday:null,plotall:!0,steppy:!1,rosy:!1,movingav:!1,aura:!1,hashtags:!0,yaxis:"",waterbuf:null,waterbux:"",hidey:!1,stathead:!0,imgsz:760,yoog:"U/G",usr:null,graph:null,goal:null,rate:null},p={sadbrink:!1,safebump:null,dueby:[],fullroad:[],pinkzone:[],tluz:null,tcur:null,vcur:null,vprev:null,rcur:null,ravg:null,tdat:null,stdflux:0,delta:0,lane:666,cntdn:0,numpts:0,mean:0,meandelt:0,proctm:0,statsum:"",ratesum:"",deltasum:"",graphsum:"",progsum:"",rah:0,safebuf:null,error:"",limsum:"",headsum:"",titlesum:"",lnw:0,color:"black",loser:!1,gldt:null,goal:null,rate:null,road:[],tini:null,vini:null,tfin:null,vfin:null,rfin:null},g=["ybhp","integery","noisy","abslnw","tagtime","timezone","backroad","edgy","offred"],h={AGGPAST:0,AGGFUTURE:1,RAWPAST:2,RAWFUTURE:3,FLATLINE:4,HOLLOW:5};return function(y){let v=this,b=d;d++,y=t.deepcopy(y);let x=[],A={},w=[],z=[],R=[],k=[],M=[],T=[],E=[],S={},U={},G={},O={},P=[];A.yaw=1,A.dir=1,A.tcur=0,A.vcur=0,A.vprev=0;const N=n.utc();function L(n){if(n.fullroad=n.fullroad.map(n=>(function(n){return Array.isArray(n)?n.length<=3?n:n.slice(0,3):n})(n)),n.road=n.fullroad,n.error)n.gldt=t.dayify(A.tfin),n.goal=A.vfin,n.rate=A.rfin*A.siru;else{const t=n.fullroad.length;t>0&&(n.gldt=n.fullroad[t-1][0],n.goal=n.fullroad[t-1][1],n.rate=n.fullroad[t-1][2])}n.tini=t.dayify(A.tini),n.vini=A.vini,n.tfin=t.dayify(A.tfin),n.vfin=A.vfin,n.rfin=A.rfin}function D(n){return Array.isArray(n)&&3===n.length?[t.dayparse(n[0]),n[1],n[2]]:n}function K(n){if(n.length<1)return n;let r=n.slice();return r[0]=t.dayify(n[0]),r}function $(n,t){let r=.25/m;"meta/derev"===A.yoog&&(r=.03/m),"meta/dpledge"===A.yoog&&(r=.03/m);let i,a,e,o,s,u=n[0][0],f=n[0][1],d=f;if(t<u)return d;for(e=1;e<n.length;e++){if(i=(a=n[e])[0]-u,o=(a[1]-f)/i,s=f,t<a[0])return s+o*(i=t-u)-o/r+(d-s+o/r)*l(-r*i);d=s+o*i-o/r+(d-s+o/r)*l(-r*i),u=a[0],f=a[1]}return s+o*(i=t-u)-o/r+(d-s+o/r)*l(-r*i)}function F(n,r,i){let a=t.zip(n);return a[1]=function(n,r,i){return t.foldlist((n,i)=>t.clip(n,i-r,i+r),n[0]+i*r,n.slice(1,n.length))}(a[1],r,i),t.zip(a)}function H(n,t,r){return F(n.slice().reverse(),t,r).reverse()}let j;N.hour(0),N.minute(0),N.second(0),N.millisecond(0),A.asof=N.unix(),A.horizon=A.asof+t.AKH,A.xMin=A.asof,A.xMax=A.horizon,A.yMin=-1,A.yMax=1;try{j=new RegExp("(?:^|\\s)(#\\p{L}[\\p{L}0-9_]+)(?=$|\\s)","gu")}catch{j=/(?:^|\s)(#[a-zA-Z]\w+)(?=$|\s)/g}function q(n){let t,r=new Set;for(j.lastIndex=0;null!=(t=j.exec(n));)""!=t[1]&&r.add(t[1]);return r}function B(n){return n[1]}function I(n,r){const i=A.kyoom&&"sum"===A.aggday;if(1===n.length)return[n[0][2],n[0][3],n[0][4]];{let a;return(a=i?t.accumulate(n.map(B)).indexOf(r):n.map(B).indexOf(r))<0?[A.aggday,null,null]:[n[a][1]+" ("+A.aggday+")",n[a][3],n[a][4]]}}let C=null;function W(n){return JSON.stringify(null==n[0]?n:[t.formatDate(n[0]),n[1],n[2]])}const J=[["deadline",n=>-64800<=n&&n<=21600,"outside 6am earlybird to 6am nightowl"],["asof",n=>null!=n,"can't be null! Tell support!"],["asof",t.torn,"isn't a valid timestamp"],["tini",t.timy,"isn't a valid timestamp"],["vini",t.nummy,"isn't numeric"],["road",t.listy,"(road matrix) isn't a list"],["tfin",t.torn,"isn't a valid timestamp"],["vfin",t.norn,"isn't numeric or null"],["rfin",t.norn,"isn't numeric or null"],["runits",n=>n in t.SECS,"isn't a valid rate unit"],["yaw",n=>0==n||1==n||-1==n,"isn't in [0,-1,1]"],["dir",n=>1==n||-1==n,"isn't in -1,1]"],["tmin",t.torn,"isn't a number/timestamp"],["tmax",t.torn,"isn't a valid timestamp"],["vmin",t.norn,"isn't numeric or null"],["vmax",t.norn,"isn't numeric or null"],["kyoom",t.torf,"isn't boolean"],["odom",t.torf,"isn't boolean"],["monotone",t.torf,"isn't boolean"],["aggday",n=>n in r.AGGR,"isn't one of max, sum, last, mean, etc"],["plotall",t.torf,"isn't boolean"],["steppy",t.torf,"isn't boolean"],["rosy",t.torf,"isn't boolean"],["movingav",t.torf,"isn't boolean"],["aura",t.torf,"isn't boolean"],["yaxis",t.stringy,"isn't a string"],["yaxis",n=>n.length<80,"string is too long\\n"],["waterbuf",t.sorn,"isn't a string or null"],["waterbux",t.stringy,"isn't a string"],["hidey",t.torf,"isn't boolean"],["stathead",t.torf,"isn't boolean"],["imgsz",t.nummy,"isn't numeric"],["yoog",t.stringy,"isn't a string"]];function Y(){A.dtf=r.stepify(z),A.road=r.fillroad(A.road,A);const n=A.road.length;A.tfin=A.road[n-1][0],A.vfin=A.road[n-1][1],A.rfin=A.road[n-1][2];const e=A.road.map(n=>n[0]);if(A.tini>e[0])return"Road dial error\\n(There are segments of your yellow brick road\\nthat are somehow dated before your road start date!)";if(!t.orderedq(e))return"Road dial error\\n(Your goal date, goal "+(A.kyoom?"total":"value")+", and rate are inconsistent!\\nIs your rate positive when you meant negative?\\nOr is your goal "+(A.kyoom?"total":"value")+" such that the implied goal date is in the past?)";A.stdflux=r.stdflux(x,z.filter(n=>n[0]>=A.tini)),function(){const n=A.asof,i=z.length,e=z[i-1][0],l=z[i-1][1];if(e>A.tfin)return;let o=e;if(A.yaw*A.dir<0)o=a(n,A.tfin);else{let e,s=null;for(;o<=a(n,A.tfin)&&(s!==(e=r.dotcolor(x,A,o,l,A.isolines))||s!==t.Cols.REDDOT);)s=e,o+=m;o=a(o,n,A.tfin);for(let n=0;n<i;n++)if(o==z[n][0])return}if(!(o in U)){const n=z[i-1];C=[o,l,"PPR",h.FLATLINE,n[0],n[1],null],z.push(C)}}();const l=z.length;if(A.movingav)if(l<=1||z[l-1][0]-z[0][0]<=0)A.filtpts=[];else{const n=function(n,r,i=6e3){return t.linspace(n,r,o(t.clip((r-n)/(m+1),a(600,640),i)))}(z[0][0],z[l-1][0],4*(z[l-1][0]-z[0][0])/m);JSON.stringify(n),A.filtpts=n.map(n=>[n,$(z,n)])}else A.filtpts=[];return A.tcur=z[l-1][0],A.vcur=z[l-1][1],A.vprev=z[i(l-2,0)][1],A.safebuf=r.dtd(x,A,A.tcur,A.vcur),A.tluz=A.tcur+A.safebuf*m,A.delta=t.chop(A.vcur-r.rdf(x,A.tcur)),A.rah=r.rdf(x,A.tcur+t.AKH),A.dueby=r.dueby(x,A,7),A.safebump=r.lim(x,A,A.safebuf),A.rcur=r.rtf(x,A.tcur)*A.siru,A.ravg=r.tvr(A.tini,A.vini,A.tfin,A.vfin,null)*A.siru,A.cntdn=s((A.tfin-A.tcur)/m),A.lane=A.yaw*(A.safebuf-(A.safebuf<=1?2:1)),A.color=A.safebuf<1?"red":A.safebuf<2?"orange":A.safebuf<3?"blue":"green",A.loser=r.redyest(x,A,A.tcur),A.sadbrink=A.tcur-m>A.tini&&r.dotcolor(x,A,A.tcur-m,A.dtf(A.tcur-m,A.isolines))==t.Cols.REDDOT,A.safebuf<=0&&(A.tluz=A.tcur),A.tfin<A.tluz&&(A.tluz=t.BDUSK),function(){if(null==A.tmin&&(A.tmin=a(A.tini,A.asof)),null==A.tmax){const n=o((A.tcur-A.tmin)/(f*m));A.tmax=t.daysnap(2*(1+n/2)*t.AKH+A.tcur)}if(null!=A.vmin&&null!=A.vmax)return void(A.vmin==A.vmax?(A.vmin-=1,A.vmax+=1):A.vmin>A.vmax&&([A.vmin,A.vmax]=[A.vmax,A.vmin]));const n=r.rdf(x,A.tmin),e=r.rdf(x,A.tmax),l=z.filter(n=>n[0]<=A.tmax&&n[0]>=A.tmin).map(n=>n[1]);let s=t.arrMin(l),u=t.arrMax(l);if(null!=C&&C[0]<=A.tmax&&C[0]>=A.tmin){const n=C[1]+r.ppr(x,A,A.asof);s=a(s,n),u=i(u,n)}const d=i(0,.015*(u-s)*2);let c=s-d,p=u+d;A.monotone&&A.dir>0?(c=t.arrMin([c,n,e]),p=t.arrMax([p,n,e])):(A.monotone&&A.dir,c=t.arrMin([c,n,e]),p=t.arrMax([p,n,e])),A.plotall&&A.tmin<=A.tini&&A.tini<=A.tmax&&A.tini in S&&(c=a(c,t.arrMin(S[A.tini].map(n=>n[1]))),p=i(p,t.arrMax(S[A.tini].map(n=>n[1])))),null==A.vmin&&null==A.vmax?(A.vmin=c,A.vmax=p,A.vmin==A.vmax?(A.vmin-=1,A.vmax+=1):A.vmin>A.vmax&&([A.vmin,A.vmax]=[A.vmax,A.vmin])):null==A.vmin?A.vmin=c<A.vmax?c:A.vmax-1:null==A.vmax&&(A.vmax=p>A.vmin?p:A.vmin+1)}(),""}this.reloadRoad=function(){const n=Y();if(""!=n)return n;if(function(n,i){const a=i.yaw,l=i.dir,s=i.lane,f=i.delta,d=i.quantum,c=a>0&&l>0,p=a<0&&l<0,g=a<0&&l>0,h=a>0&&l<0,y=(n,r=a,i=4,e=2)=>null===d?t.shn(n,i,e,r):t.conservaround(n,d,r),v=(n,t=a,r=4,i=2)=>(n>=0?"+":"")+y(n,t,r,i);if(""!=i.error)return void(i.statsum=" error:    "+i.error+"\\n");const b=t.zip(i.road)[2];let A=t.arrMin(b),w=t.arrMax(b);if(e(A)>e(w)){const n=A;A=w,w=n}const R=t.shn(A,4,2),k=t.shn(w,4,2),M=t.shn(i.ravg,4,2),T=t.shn(i.rcur,4,2);i.ratesum=(A===w?R:"between "+R+" and "+k)+" per "+t.UNAM[i.runits]+(A!==w?" (current: "+T+", average: "+M+")":"");const E=t.shn(t.cvx(t.daysnap(i.tcur),i.tini,t.daysnap(i.tfin),0,100,!1),1,1);let S,U,G=t.cvx(i.vcur,i.vini,i.vfin,0,100,!1);G=t.shn(i.vini<i.vfin?G:100-G,1,1),i.progsum=E==G?E+"% done":E+"% done by time -- "+G+"% by value",i.cntdn<7?(S=u(i.rfin)*(i.vfin-i.vcur),U="To go to goal: "+y(S,0,2,1)+"."):U="Yellow Brick Rd = "+((S=r.rdf(x,i.tcur+i.siru)-r.rdf(x,i.tcur))>=0?"+":"")+t.shn(S,2,1,0)+" / "+t.UNAM[i.runits]+".",i.graphsum=y(i.vcur,0,3,1)+" on "+t.shd(i.tcur)+" ("+t.splur(i.numpts,"datapoint")+" in "+t.splur(1+o((i.tcur-i.tini)/m),"day")+") targeting "+y(i.vfin,0,3,1)+" on "+t.shd(i.tfin)+" ("+t.splur(i.cntdn,"more day")+"). "+U,i.deltasum=y(e(f),0)+" "+i.gunits+(f<0?" below":" above")+" the bright line";const O=i.safebuf,P=t.splur(O,"day"),N=r.lim(x,i,c||p?O:0),L=r.limd(x,i,c||p?O:0);i.kyoom?(c&&(i.limsum=v(L)+" in "+P),p&&(i.limsum=v(L)+" in "+P),g&&(i.limsum=v(L)+" today"),h&&(i.limsum=v(L)+" today")):(c&&(i.limsum=v(L)+" in "+P+" ("+y(N)+")"),p&&(i.limsum=v(L)+" in "+P+" ("+y(N)+")"),g&&(i.limsum=v(L)+" today ("+y(N)+")"),h&&(i.limsum=v(L)+" today ("+y(N)+")")),i.safeblurb=a*l<0?"unknown days of safety buffer":O>999?"more than 999 days of safety buffer":"~"+P+" of safety buffer",i.titlesum=t.toTitleCase(i.color)+": bmndr.com/"+i.yoog+" is safe for ~"+P+(0===O?" (beemergency!)":""),i.headsum=i.titlesum,i.statsum=" progress: "+t.shd(i.tini)+"  "+(null==z?"?":t.shn(i.vini,4,2,0))+"\\n           "+t.shd(i.tcur)+"  "+t.shn(i.vcur,4,2,0)+"   ["+i.progsum+"]\\n           "+t.shd(i.tfin)+"  "+t.shn(i.vfin,4,2,0)+"\\n rate:     "+i.ratesum+"\\n lane:     "+(666==e(s)?"n/a":s)+"\\n safebuf:  "+i.safebuf+"\\n delta:    "+i.deltasum+"\\n ",i.statsum+=0==a?"limit:    ":a<0?"hard cap: ":"bare min: ",i.statsum+=i.limsum+"\\n"}(0,A),A.fullroad=A.road.slice(),A.fullroad.unshift([A.tini,A.vini,0,0]),""==A.error&&(A.pinkzone=[[A.asof,r.rdf(x,A.asof),0]],A.road.forEach(function(n){n[0]>A.asof&&n[0]<A.asof+t.AKH&&A.pinkzone.push([n[0],n[1],null])}),A.pinkzone.push([A.asof+t.AKH,r.rdf(x,A.asof+t.AKH),null]),A.pinkzone=r.fillroadall(A.pinkzone,A)),A.aura){const n=z.filter(n=>n[0]>=A.tmin),t=r.gapFill(n);A.auraf=r.smooth(t)}else A.auraf=(n=>0);A.dtdarray=r.dtdarray(x,A),A.isolines=[];for(let n=0;n<4;n++)A.isolines[n]=r.isoline(x,A.dtdarray,A,n);return""};let V={};this.getStats=function(){return t.deepcopy(V)},this.setRoadObj=function(n){if(0!=n.length){x=n,v.roads=x,A.road=[];for(let n=1;n<x.length;n++)A.road.push([x[n].sta[0],x[n].sta[1],x[n].slope]);v.gol=A,v.reloadRoad()}else console.log("id="+b+", setRoadObj(), null road!")},function(e,l,o=null){try{null==o&&(o=n.utc().unix()),function(n){"goal"in n&&!("vfin"in n)&&(n.vfin=n.goal),"rate"in n&&!("rfin"in n)&&(n.rfin=n.rate),"usr"in n&&"graph"in n&&!("yoog"in n)&&(n.yoog=n.usr+"/"+n.graph)}(e),function(){z=[],C=null,k=[],S={},U={},G={},(A={}).siru=null,M=[],T=[],O={};for(const n in p)A[n]=p[n];for(const n in c)A[n]=c[n]}(),A.proctm=o,z=function(n,r){return["asof","tini","tfin","tmin","tmax"].map(r=>{r in n&&(n[r]=t.dayparse(n[r]))}),"road"in n&&t.listy(n.road)&&(n.road=n.road.map(D)),r.map((n,r)=>[t.dayparse(n[0]),n[1],n[2],r,n[1]]).sort((n,t)=>n[0]!==t[0]?n[0]-t[0]:n[3]-t[3])}(e,l);const s=[];for(const n in e)n in e&&(n in c||g.includes(n)?A[n]=e[n]:s.push(`${n}=${e[n]}`));s.length>0&&(A.error+=`Unknown param${1===s.length?"":"s"}: ${s.join(", ")}`),"aggday"in e||(e.aggday=A.kyoom?"sum":"last"),A.siru=t.SECS[A.runits],A.horizon=A.asof+t.AKH,A.waterbuf0=A.waterbuf,t.listy(A.road)&&A.road.push([A.tfin,A.vfin,A.rfin]),""==A.error&&(A.error=function(){const n=n=>JSON.stringify(n);let r;for(r=0;r<J.length;r++){const t=J[r];if(!t[1](A[t[0]]))return`'${t[0]}' ${t[2]}: ${n(A[t[0]])}`}const i=A.road;for(r=0;r<i.length;r++)if(a=i[r],!t.listy(a)||3!=a.length||!(null==a[0]&&t.nummy(a[1])&&t.nummy(a[2])||t.nummy(a[0])&&null==a[1]&&t.nummy(a[2])||t.nummy(a[0])&&t.nummy(a[1])&&null==a[2]))return"Invalid road matrix row: "+W(i[r]);var a;const e=i.slice(1,i.length-1);if(e.length!=t.deldups(e).length){let n=e[0];for(r=1;r<e.length;r++){if(t.arrayEquals(e[r],n))return"Road matrix has duplicate row: "+W(e[r]);n=e[r]}return"Road matrix duplicate row error! Tell support!"}return A.kyoom&&A.odom?"The odometer setting doesn't make sense for an auto-summing goal!":""}()),""==A.error&&(A.error=function(){if(null==z||0==z.length)return"No datapoints";const n=z.length;let i,a;for(i=0;i<n;i++){if(a=z[i],!(t.nummy(a[0])&&a[0]>0&&t.nummy(a[1])&&t.stringy(a[2])))return"Invalid datapoint: "+a[0]+" "+a[1]+' "'+a[3];if(A.hashtags){const n=q(a[2]);if(0==n.size)continue;a[0]in O||(O[a[0]]=new Set);for(const t of n)O[a[0]].add(t)}}if(A.hashtags){P=[],Object.keys(O);for(const n in O)P.push([n,Array.from(O[n]).join(" ")])}for(T=(T=z.filter(n=>(function(n){return n.startsWith("RECOMMITTED")})(n[2]))).map(n=>n.slice()),i=0;i<T.length;i++){const n=1562299200;T[i][0]<n&&(T[i][0]=T[i][0]-m)}A.odom&&(M=z.filter(n=>0==n[1]).map(n=>n[0]),r.odomify(z));const e=z.filter(n=>n[0]<=A.asof);A.plotall&&(A.numpts=e.length),S={},U={};let l,o=[],s=z[0][0],u=[],f=0;for(r.rsk8=A.rfin*m/A.siru,i=0;i<=z.length;i++)if(i<z.length&&z[i][0]==s&&u.push(z[i].slice()),i>=z.length||z[i][0]!=s){let n=u.map(B),a=r.AGGR[A.aggday](n);l=o.length>0?o[o.length-1]:[s,a+f];let e=I(u,a);o.push([s,f+a,e[0],s<=A.asof?h.AGGPAST:h.AGGFUTURE,l[0],l[1],e[2],e[1]]),A.kyoom?("sum"===A.aggday?S[s]=t.accumulate(n).map((n,t)=>[s,n+f,u[t][2],u[t][3],u[t][4]]):S[s]=u.map(n=>[s,n[1]+f,n[2],n[3],n[4]]),U[s]=f+a,f+=a):(S[s]=u,U[s]=a);const m=S[s].map(n=>n[1]);G[s]=A.yaw<0?t.arrMax(m):t.arrMin(m),i<z.length&&(s=z[i][0],u=[z[i].slice()])}let d=[];for(let n in S)d=d.concat(S[n].map(t=>[Number(n),t[1],t[2],Number(n)<=A.asof?h.AGGPAST:h.AGGFUTURE,null,null,t[4],t[3]]));if(w=d,k=o.filter(n=>n[0]>A.asof),0==(z=o.filter(n=>n[0]<=A.asof)).length)return"All datapoints are in the future!";A.plotall||(A.numpts=z.length);const c=r.gapFill(z).map(n=>n[1]);for(z.length>0&&(A.mean=t.mean(c)),z.length>1&&(A.meandelt=t.mean(t.partition(c,2,1).map(n=>n[1]-n[0]))),A.tdat=z[z.length-1][0],i=0;i<T.length;i++){const n=1562299200;(s=T[i][0]<n?T[i][0]+m:T[i][0])in G&&(T[i][1]=U[s])}return E=z.filter(n=>n[0]in S&&n[0]<A.asof&&!S[n[0]].map(n=>n[1]).includes(n[1])),""}()),""==A.error&&(A.error=function(n){const i=t.BDUSK;x=[];const e=n,l=e.length;let o,s=A.tini,u=A.vini;null!=e[0][0]&&e[0][0]<s&&(s=e[0][0],null!=e[0][1]&&(u=e[0][1])),(o={sta:[s,Number(u)],slope:0,auto:r.RP.SLOPE}).end=o.sta.slice(),o.sta[0]=t.daysnap(o.sta[0]-100*m*f),x.push(o);for(let n=0;n<l;n++){let t={};t.sta=x[x.length-1].end.slice();let l=null,o=null,s=null;l=e[n][0],o=e[n][1],s=e[n][2],null==l?(t.end=[0,Number(o)],t.slope=Number(s)/A.siru,0!=t.slope?t.end[0]=t.sta[0]+(t.end[1]-t.sta[1])/t.slope:(t.end[0]=i,t.end[1]=t.sta[1]),t.end[0]=a(i,t.end[0]),t.end[1]=t.sta[1]+t.slope*(t.end[0]-t.sta[0]),t.auto=r.RP.DATE):null==o?(t.end=[l,0],t.slope=Number(s)/A.siru,t.end[1]=t.sta[1]+t.slope*(t.end[0]-t.sta[0]),t.auto=r.RP.VALUE):null==s&&(t.end=[l,Number(o)],t.slope=r.segSlope(t),t.auto=r.RP.SLOPE),t.end[0]>=t.sta[0]&&x.push(t)}const d=x[x.length-1],c={sta:d.end.slice(),end:d.end.slice(),slope:0,auto:r.RP.VALUE};return c.end[0]=t.daysnap(c.end[0]+100*m*f),x.push(c),""}(e.road)),""==A.error&&(A.error=v.reloadRoad()),function(){if(!A.rosy||0==z.length)return;const n=i(0,A.stdflux);let r,a;A.dir>0?(r=F(z,n,-1),a=H(z,n,1)):(r=H(z,n,-1),a=F(z,n,1));const e=r.map(n=>n[1]),l=a.map(n=>n[1]),o=t.zip([e,l]).map(n=>(n[0]+n[1])/2),s=z.map(n=>n[0]);R=(R=t.zip([s,o])).map(n=>[n[0],n[1],"rosy data",h.RAWPAST,n[0],n[1],n[1]]);for(let n=1;n<R.length-1;n++)R[n][4]=R[n-1][0],R[n][5]=R[n-1][1]}()}finally{V=Object.assign({},p);for(const n in V)V[n]=A[n];!function(n){n.fullroad=n.fullroad.map(K),"razrmatr"in p&&(n.razrmatr=n.razrmatr.map(K)),n.pinkzone=n.pinkzone.map(K),n.tluz=t.dayify(n.tluz),n.tcur=t.dayify(n.tcur),n.tdat=t.dayify(n.tdat)}(V),L(V)}}(y.params,y.data),A.graphurl=t.BBURL,A.thumburl=t.BBURL,this.id=b,this.DPTYPE=h,this.roads=x,this.gol=A,this.data=z,this.rosydata=R,this.alldata=w,this.allvals=S,this.fuda=k,this.flad=C,this.oresets=M,this.derails=T,this.hollow=E,this.hashtags=P}});