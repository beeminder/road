As some of you may already know, some types of Beeminder graphs (e.g. lose-weight) feature a "moving average" line, together with an "aura" that seek to provide smoothed out versions of your data. The motivation behind these were to help you identify various trends and tendencies in your data, without being distracted by daily fluctuations particularly when data is coming from by inherently unpredictable sources such as one's weight.

So far, these two visual features of Beeminder graphs have not been particularly effective and suffered from various inaccuracies and deficiencies as exemplified in https://github.com/beeminder/road/issues/152. In particular, the moving average line (MAV) used a cumulative weighted, "exponential" average of datapoints starting from the beginning, moving towards the end (see https://en.wikipedia.org/wiki/Exponential_smoothing for details). This technique has the unfortunate consuquence that the resulting filtered line is delayed by a significant amount of time, which makes it lag behind the actual data (i.e. it seems to be further right in the graph that the actual data). This was particularly noticeable for monotonic graphs such as do-more where the moving average line was visibly offset from the actual datapoints. This was in conflict with the goals of the MAV feature, which was to provide an accurate (and undelayed) smoothed out version of your data.

The aura, on the other hand, had a different goal (more like, two different goals). First, it was intended to visualize a coarse "envelope" around the entirety of your data so you could see both how your progress has evolved over a long time period (the shape of the aura), as well as how much variability was expected/observed in the data (the thickness of the aura). The second goal of the aura was to provide a crude but hopefully informative estimate of how your data would progress towards the akrasia horizon that is located a week ahead of today. To this end, the aura used a polynomial (of third degree or lower) that best fits to the visible portion of the data. However, since Beeminder goals usually have a wide range of data trends (e.g. variations based on different seasons, motivational levels, life circumstances etc.), such a low-degree polynomial approximation often failed (sometimes miserably) to achieve either one of these goals.

All of these observations led to our recent revision of both the MAV and the aura generation. We describe below the machinery behind the new versions, and hopefully how they address these concerns.

The algorithms we use to generate the updated versions of these features is based on filtering methods in singal processing. In particular, there are two types of commonly used digital filters, Finite-Impulse-Response (FIR) (https://en.wikipedia.org/wiki/Finite_impulse_response) and Infinite-Impulse-Response (IIR) (https://en.wikipedia.org/wiki/Infinite_impulse_response) filters. FIR filters are akin to moving average filters with a finite window, examples of which are, for example, very common in image filters such as blurring. IIR filters, on the other hand, are closer to the exponential filter mentioned above, beloging to a more general class of recursive filters wherein incoming data is passed through a discrete dynamical system taking past and present values of both the data and the filter states to compute the next filtered data point. Both of these alternatives have pros and cons with respect to computational efficiency anf accuracy, but it turns out that the faster IIR filters were more appropriate for our use cases.

In signal processing, such filters are characterized with their "frequency response", which is how much of various frequency components of the original signal they let through to their output, and how much delay they introduce to each of these frequencies. A useful analogy is with "equalizers" in sound systems wherein one can increase or decrease high, low or middle range frequencies in a sound signal to elininate "noise". That is in fact very informative for what we do, since both the MAV and the aura should be obtained by eliminating high-frequency changes (i.e. daily fluctuations) and show low frequency components (week-to-week or month-to-month trends). Consequently, what we need are so-called "low-pass" filters, which allow low frequency components in the data "signal" and block high frequency components.
