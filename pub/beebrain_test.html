<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src = "https://d3js.org/d3.v4.js"></script>
    <script src = "moment.min.js"></script>
    <script src = "pikaday.js"></script>
    <script src = "polyfit.js"></script>
    <script src = "butil.js"></script>
    <script src = "broad.js"></script>
    <script src = "beebrain.js"></script>
    <script src = "bgraph.js"></script>
    <script src = "btest.js"></script>
</head>
<body>

<div id="results"></div>
  
<script>

  var files = [
  "afcuttin+gmailzero",
  "aimeeg+weight",
  "a+job",
  "aj+travel",
  "alicegong+moneytimesleep",
  "ardeibel+math",
  "ardeibel+reading",
  "avogadro+programiranje",
  "b+coffee",
  "b+fdl", // Differs due to a Math.round difference between python and Javascript
  "bluetulip+work-oops-tagtime",
  "b+meta",
  "b+weight",
  "byorgey+bites",
  "caillu+duolingo-spanish",
  "cambienta+limit_outbursts",
  "chris_s+audible_listening",
  "dan+ankicards",
  "denizsurmeli+coding",
  "divide+housework",
  "dmiheler+rbook",
  "drtall+gmailzero",
  "elwyn+waist",
  "ffukuchi+meditation",
  "fightdiet+team1",
  "jabee+weight",
  "jalexwood+notlookquitesospherical",
  "johnmarkos+booze",
  "johnmarkos+weight2",
  "jonathandupont+units",
  "justyn+gmailzero",
  "kdmprincess+net_calories",
  "ku+weight",
  "lharringtonmissin+weight",
  "mbork+journal",
  "mbork+ledger",
  "muskwalker+weight",
  "nacks+nacks",
  "neinei+stay_dance_eye_contact",
  "njberry+riseup",
  "oxfe+bookofmormon",
  "pmyteh+procrastination",
  "rfnash+bookmarks",
  "riderback65+core_and_pt",
  "rjhanes19+deficit",
  "romduda+moodscope1",
  "samuelb+sleep",
  "seanaas+germanpractice",
  "smurfeater+anki",
  "sohum+weight",
  "ssog+bench",
  "tristanpendergrass+piano-reps",
  "uwchem94+calorie_deficit",
  "vijaytalluru+nocomics",
  "vinciamorim+bodygym",
  "volya+french",
  "whackedspinach+inbox-zero",
  "xenocid+gmailzero", // Fails because of the last road segment with 0 slope, no date
  "yatsynych+guitar",
  "yebyenw+20-minutes",
  "zachzaslow+sleep",
  "zarbockc+eating"
  ];
  
  async function testGoal( url, pyouturl ) {
    if (url == "") return;
    console.debug("Loading "+url)
    var resp = await butil.loadJSON(url);
    console.debug(resp)
    console.debug("Loading "+pyouturl)
    var bbr = await butil.loadJSON(pyouturl);
    console.debug(bbr)

    if (resp != null && bbr != null) {

      var jsb = new beebrain( resp ),
          stats = jsb.getStats()

      var res = await btest.compareOutputs(stats, bbr)
      return res
    }
  }

  async function testAll() {
    const rDiv = document.getElementById('results'); 
    while (rDiv.firstChild) {
      rDiv.removeChild(rDiv.firstChild);
    }

    var i, innerDiv, info, exact = 0, numeric = 0, error = 0;
    for (i = 0; i < files.length; i++) {
      console.log("Processing "+files[i])
      res = await testGoal("testbb/"+files[i]+".bb", "testbb/"+files[i]+".json");

      innerDiv = document.createElement('div')
      innerDiv.className = 'resulttitle'
      innerDiv.style.margin = '4px'
      if (res.valid) {
        if (res.numeric) {
          info = "(numeric errors)"
          numeric = numeric+1
          innerDiv.style.background = '#aaaaff'
        } else {
          info = "(exact match)"
          exact = exact+1
          innerDiv.style.background = '#aaffaa'
        }
      } else {
        info = "(string or critical errors)"
        error = error+1
        innerDiv.style.background = '#ffaaaa'
      }
      rDiv.appendChild(innerDiv)
      innerDiv.innerHTML = "Goal "+files[i]+" "+info
        +" <a href=\"compare.html?base="+files[i]+"&path=testbb\" target=\"blank\"=>Graph comparison</a>"

      innerDiv = document.createElement('div')
      innerDiv.className = 'result'
      rDiv.appendChild(innerDiv)
      innerDiv.innerHTML = res.result
    }
    innerDiv = document.createElement('div')
    innerDiv.className = 'result'
    innerDiv.style.border = '2px solid black'
    innerDiv.style.padding = '5px'
    rDiv.prepend(innerDiv);
    innerDiv.innerHTML = "RESULTS ("+files.length+" goals): Exact matches: "+exact+", Numeric errors: "+numeric
                    +", string or critical: "+error
  }
  testAll()
</script>

</body>
</html>
