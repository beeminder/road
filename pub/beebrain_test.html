<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src = "https://d3js.org/d3.v4.js"></script>
    <script src = "moment.min.js"></script>
    <script src = "pikaday.js"></script>
    <script src = "polyfit.js"></script>
    <script src = "butil.js"></script>
    <script src = "broad.js"></script>
    <script src = "beebrain.js"></script>
    <script src = "bgraph.js"></script>
    <script src = "btest.js"></script>
</head>
<body>

<div id="results"></div>
  
<script>

  var files = [
  "afcuttin+gmailzero",
  "aimeeg+weight",
  "a+job",
  "aj+travel",
  "alicegong+moneytimesleep",
  "ardeibel+math",
  "ardeibel+reading",
  "avogadro+programiranje",
  "b+coffee",
  "b+fdl",
  "bluetulip+work-oops-tagtime",
  "b+meta",
  "b+weight",
  "byorgey+bites",
  "caillu+duolingo-spanish",
  "cambienta+limit_outbursts",
  "chris_s+audible_listening",
  "dan+ankicards",
  "denizsurmeli+coding",
  "divide+housework",
  "dmiheler+rbook",
  "drtall+gmailzero",
  "elwyn+waist",
  "ffukuchi+meditation",
  "fightdiet+team1",
  "jabee+weight",
  "jalexwood+notlookquitesospherical",
  "johnmarkos+booze", // Very small numeric differences result in lane difference
  "johnmarkos+weight2",
  "jonathandupont+units",
  "justyn+gmailzero",
  "kdmprincess+net_calories",
  "ku+weight",
  "kyshoc+nutrition",
  "lharringtonmissin+weight",
  "mbork+journal",
  "mbork+ledger",
  "muskwalker+weight", // rate=0 and date=null in final row
  "nacks+nacks",
  "neinei+stay_dance_eye_contact",
  "njberry+riseup",
  "oxfe+bookofmormon",
  "pmyteh+procrastination",
  "rfnash+bookmarks",
  "riderback65+core_and_pt",
  "rjhanes19+deficit",
  "romduda+moodscope1",
  "samuelb+sleep",
  "seanaas+germanpractice",
  "smurfeater+anki",
  "sohum+weight",
  "ssog+bench",
  "tristanpendergrass+piano-reps",
  "uwchem94+calorie_deficit",
  "vijaytalluru+nocomics",
  "vinciamorim+bodygym",
  "volya+french",
  "whackedspinach+inbox-zero",
  "xenocid+gmailzero", // This has rate=0 and date=null as the final row
  "yatsynych+guitar",
  "yebyenw+20-minutes",
  "zachzaslow+sleep",
  "zarbockc+eating"
  ];
  
  async function testAll() {
    const rDiv = document.getElementById('results'); 
    while (rDiv.firstChild) {
      rDiv.removeChild(rDiv.firstChild);
    }

    var i, innerDiv, info, exact = 0, numeric = 0, error = 0;
    for (i = 0; i < files.length; i++) {
      console.log("Processing "+files[i])
      res = await btest.compareWithPybrain("testbb/"+files[i]+".bb", "testbb/"+files[i]+".json");
      
      innerDiv = document.createElement('div')
      innerDiv.className = 'resulttitle'
      innerDiv.style.margin = '4px'
      if (res.valid) {
        if (res.numeric) {
          info = "[NUMERIC ERRORS]"
          numeric = numeric+1
          innerDiv.style.background = '#aaaaff'
        } else {
          info = "[EXACT MATCH]"
          exact = exact+1
          innerDiv.style.background = '#aaffaa'
        }
      } else {
        info = "[OTHER ERRORS]"
        error = error+1
        innerDiv.style.background = '#ffaaaa'
      }
      rDiv.appendChild(innerDiv)
      innerDiv.innerHTML = (i+1)+": GOAL <b>"+files[i]+"</b> "+" ("+res.typestr+") "+info
        +"</br> &nbsp;&nbsp;>>> <a href=\"compare.html?base="+files[i]+"&path=testbb\" target=\"blank\"=>Click to compare graphs</a>"

      innerDiv = document.createElement('div')
      innerDiv.className = 'result'
      rDiv.appendChild(innerDiv)
      innerDiv.innerHTML = res.result
    }
    innerDiv = document.createElement('div')
    innerDiv.className = 'result'
    innerDiv.style.border = '2px solid black'
    innerDiv.style.padding = '5px'
    rDiv.prepend(innerDiv);
    innerDiv.innerHTML = "RESULTS ("+files.length+" goals): Exact matches: "+exact+", Numeric errors: "+numeric
                    +", string or critical: "+error
  }
  testAll()
</script>

</body>
</html>
