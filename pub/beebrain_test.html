<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src = "../pub/moment.min.js"></script>
</head>
<body>

  <div id="results"></div>
  
<script src = "polyfit.js"></script>
<script src = "butil.js"></script>
<script src = "broad.js"></script>
<script src = "beebrain.js"></script>
<script src = "btest.js"></script>
<script>

  var files = [
  <!-- "afcuttin+gmailzero", -->
  <!-- "aimeeg+weight", -->
  <!-- "a+job", -->
  <!-- "aj+travel", -->
  <!-- "alicegong+moneytimesleep", -->
  <!-- "ardeibel+math", -->
  <!-- "ardeibel+reading", -->
  <!-- "avogadro+programiranje", -->
  <!-- "b+coffee", -->
  <!-- "b+fdl", -->
  <!-- "bluetulip+work-oops-tagtime", -->
  <!-- "b+meta", -->
  <!-- "b+weight", -->
  <!-- "byorgey+bites", -->
  <!-- "caillu+duolingo-spanish", -->
  <!-- "cambienta+limit_outbursts", -->
  <!-- "chris_s+audible_listening", -->
  <!-- "dan+ankicards", -->
  <!-- "denizsurmeli+coding", -->
  <!-- "divide+housework", -->
  "dmiheler+rbook",
  "drtall+gmailzero",
  "elwyn+waist",
  "ffukuchi+meditation",
  "fightdiet+team1",
  "jabee+weight",
  "jalexwood+notlookquitesospherical",
  "johnmarkos+booze",
  "johnmarkos+weight2",
  "jonathandupont+units",
  "justyn+gmailzero",
  "kdmprincess+net_calories",
  "ku+weight",
  "kyshoc+nutrition",
  "lharringtonmissin+weight",
  "mbork+journal",
  "mbork+ledger",
  "muskwalker+weight",
  "nacks+nacks",
  "neinei+stay_dance_eye_contact",
  "njberry+riseup",
  "oxfe+bookofmormon",
  "pmyteh+procrastination",
  "rfnash+bookmarks",
  "riderback65+core_and_pt",
  "rjhanes19+deficit",
  "romduda+moodscope1",
  "samuelb+sleep",
  "seanaas+germanpractice",
  "smurfeater+anki",
  "sohum+weight",
  "ssog+bench",
  "tristanpendergrass+piano-reps",
  "uwchem94+calorie_deficit",
  "vijaytalluru+nocomics",
  "vinciamorim+bodygym",
  "volya+french",
  "whackedspinach+inbox-zero",
  "xenocid+gmailzero",
  "yatsynych+guitar",
  "yebyenw+20-minutes",
  "zachzaslow+sleep",
  "zarbockc+eating"
  ];
  //files = ["afcuttin+gmailzero"]
  
  async function testGoal( url, outurl ) {
    if (url == "") return;
    console.debug("Loading "+url)
    var resp = await butil.loadJSON(url);
    console.debug(resp)
    console.debug("Loading "+outurl)
    var bbr = await butil.loadJSON(outurl);
    console.debug(bbr)

    if (resp != null && bbr != null) {

      var jsb = new beebrain( resp ),
          stats = jsb.getStats()

      var res = await btest.compareOutputs(stats, bbr)
      return res
    }
  }

  async function testAll() {
    const rDiv = document.getElementById('results'); 
    while (rDiv.firstChild) {
      rDiv.removeChild(rDiv.firstChild);
    }

    var i, innerDiv;
    for (i = 0; i < files.length; i++) {
      console.log("Processing "+files[i])
      res = await testGoal("testbb/"+files[i]+".bb", "testbb/"+files[i]+".json");

      innerDiv = document.createElement('div');
      innerDiv.className = 'resulttitle';
      if (res.valid)
        innerDiv.style.background = '#aaffaa';
      else
        innerDiv.style.background = '#ffaaaa';
      rDiv.appendChild(innerDiv);
      innerDiv.innerHTML = "Goal "+files[i];

      innerDiv = document.createElement('div');
      innerDiv.className = 'result';
      rDiv.appendChild(innerDiv);
      innerDiv.innerHTML = res.result
    }
  }
  testAll()
</script>

</body>
</html>
