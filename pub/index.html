<!DOCTYPE html>
<html>
<head>
  <title>Playing with Road Editor Interfaces</title>
  <meta name="description" content="Playing with Road Editor interfaces in Glitch">
  <link id="favicon" rel="icon" href="https://glitch.com/favicon.ico" type="image/x-icon">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="pikaday.css">
  <link rel="stylesheet" href="roadeditor.css">
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src = "moment.min.js"></script>
  <script src = "pikaday.js"></script>
</head>

<body>

<h1>Beeminder's New Visual Road Editor</h1>

<h2>Instructions:</h2>
<ul>
<li>Shift-click, double-click, or long-press (mobile) on blank area: Add new node</li>
<li>Ctrl-click on dots / segments / vertical lines to edit end values / rates / end dates</li>
<li>Scroll wheel to zoom the x axis, use the context graph at the bottom to adjust zoom region</li>
<li>Ctrl-Z to undo, Ctrl-y to redo</li>
</ul>

 <select id="roadselect" class="roadselect" onchange="editor.loadGoal(this.value);">
  <option value="data/testroad0.json">Test Road 0</option>
  <option value="data/testroad1.json">Test Road 1</option>
  <option value="data/testroad2.json">Test Road 2</option>
  <option value="data/testroad3.json">Test Road 3</option>
  <option value="data/testroad4.json">Test Road 4</option>
  <option value="data/testroad5.json">Test Road 5</option>
  <option value="data/testroad6.json">Test Road 6</option>
  <option value="data/testroad7.json">Test Road 7</option>
</select> 
  
<table>
  <tr>
    <td valign="top"><div id="roadgraph"></div>
      <input id="showdata" type="checkbox" onclick="editor.showData(this.checked);" checked>Show datapoints
      <input id="showcontext" type="checkbox" onclick="editor.showContext(this.checked);" checked>Show context graph<br>
      <input id="keepslopes" type="checkbox" onclick="editor.keepSlopes(this.checked);" checked>Keep slopes fixed<br>
      <input id="keepintervals" onclick="editor.keepIntervals(this.checked);" type="checkbox">Keep intervals fixed<br>
      <button id="zoomall" onclick="editor.zoomOut();">Zoom To Fit</button>
      <button id="undo" onclick="editor.undo();">Undo (0)</button>
      <button id="redo" onclick="editor.redo();">Redo (0)</button><br/><br/>
      Safe days: <input type = "number" value="0" min="0" id="ratchetdays"><button id="retroratchet" onclick="var val = document.getElementById(&quot;ratchetdays&quot;).value; if (!isNaN(val)) editor.retroRatchet(Number(val));">Retroratchet</button><br/>
      <br/><br/>
    </td>
    <td valign="top">
      <div id="roadtable"></div>
      <br/>
      <input id="autoscroll" type="checkbox" onclick="editor.autoScroll(this.checked);">Auto-scroll table<br>
      <input id="reversetable" type="checkbox" onclick="editor.reverseTable(this.checked);">Reverse table order<br/>

    </td>
  </tr>
</table>
  
<script src="/roadeditor.js"></script>

<script>
  var undoBtn = document.getElementById("undo");
  var redoBtn = document.getElementById("redo");
  function roadChanged() {
    var bufStates = editor.undoBufferState();
    if (bufStates.undo === 0)  {
      undoBtn.disabled = true;
      undoBtn.innerHTML = "Undo (0)";
    } else {
      undoBtn.disabled = false;
      undoBtn.innerHTML = "Undo ("+bufStates.undo+")";
    }
    if (bufStates.redo === 0)  {
      redoBtn.disabled = true;
      redoBtn.innerHTML = "Redo (0)";
    } else {
      redoBtn.disabled = false;
      redoBtn.innerHTML = "Redo ("+bufStates.redo+")";
    }
  }

  var editor = new bmndr({divGraph: document.getElementById('roadgraph'),
                          divTable: document.getElementById('roadtable'),
                          roadEditor: false,
                          maxFutureDays: 365,
                          showFocusRect: true,
                          showContext: true,
                          onRoadChange: roadChanged});
  editor.showData(document.getElementById("showdata").checked);
  editor.showContext(document.getElementById("showcontext").checked);
  editor.keepSlopes(document.getElementById("keepslopes").checked);
  editor.keepIntervals(document.getElementById("keepintervals").checked);
  editor.reverseTable(document.getElementById("reversetable").checked);
  editor.autoScroll(document.getElementById("autoscroll").checked);

  editor.loadGoal(document.getElementById("roadselect").value);

  function documentKeyDown(e) {
    var evtobj = window.event? window.event : e;
    if (evtobj.keyCode == 89 && evtobj.ctrlKey) editor.redo();
    if (evtobj.keyCode == 90 && evtobj.ctrlKey) editor.undo();
  }
        
  document.onkeydown = documentKeyDown;
</script>

<h3>Credits</h3>

<p>
<a href="http://www.ceng.metu.edu.tr/~saranli/">Uluc Saranli</a>
(known in Beeminderland for 
<a href="http://blog.beeminder.com/beedroid/">Beedroid</a>)
wrote this.  
<a href="https://glitch.com/#!/project/road">See the code</a>
on
<a href="https://glitch.com">Glitch</a>
or ask 
<a href="http://dreev.es">dreeves</a>
for a link to live-edit it with us.
</p>

</body>
</html>

<!--
    <script src="https://code.jquery.com/jquery-2.2.1.min.js"
            integrity="sha256-gvQgAFzTH6trSrAWoH1iPo9Xc96QxSZ3feW6kem+O00="
            crossorigin="anonymous"></script>
    <script src="/client.js"></script>
-->
