<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script src = "../pub/moment.min.js"></script>
</head>
<body>

<script src = "jsbrain.js"></script>
<script>
  function loadJSON( url ) {   
    console.debug("loadJSON: "+url)
    return new Promise(function(resolve, reject) {
      if (url === "") resolve(null)
      var xobj = new XMLHttpRequest()
      xobj.overrideMimeType("application/json")
      xobj.onreadystatechange = function () {
        if (xobj.readyState == 4 
            && (xobj.status == "200"
                || (xobj.status == "0" && xobj.responseText !== ""))) {
          resolve(JSON.parse(xobj.responseText))
        } else if (xobj.readyState == 4) {
          resolve(null)
        }
      }
      xobj.open('GET', url, true)
      xobj.send(null)
    })
  }

  async function testGoal( url, outurl ) {
    console.debug( "Loading: "+url );
    if (url == "") return;
    var jsb = null;
    var resp = await loadJSON(url);
    console.debug("Loaded goal details from "+url+", resp=")
    console.debug(resp)
    var bbr = await loadJSON(outurl);
    console.debug("Loaded beebrain output from "+outurl+", resp=")
    console.debug(bbr)

    if (resp != null && bbr != null) {
      // Create new jsbrain object
      jsb = new jsbrain( resp )
      // Retrieve stats output
      var stats = jsb.getStats()
      console.log( stats )
      // Compare properties
      for (prop in bbr) {
        if (!stats.hasOwnProperty(prop))
          console.log("Property "+prop+" is missing from the output")
        else if (stats[prop] !== bbr[prop]) 
          console.log("Property "+prop+" differs: "+stats[prop]+ " !== "+bbr[prop])
      }
    }
  }

  testGoal("data/testroad0.bb", "data/testroad0_beebrain.json");
</script>

</body>
</html>
